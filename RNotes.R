# Rè¯­è¨€å…¥é—¨ä¸æ•°æ®åˆ†æ-----------------------------------------------------------
# Creater: Fangyi Li
# æ­¤ç¬”è®°åŸºäºå“”å“©å“”å“©å¼¹å¹•ç½‘è§†é¢‘ï¼šRè¯­è¨€å…¥é—¨ä¸æ•°æ®åˆ†æï¼ˆupä¸»idï¼šåŸºå› å­¦é™¢ï¼‰æ€»ç»“è€Œæˆã€‚
# This note is created based on a video, Introduction to R programming language 
# and data analysis, on the website of Bilibili (id: åŸºå› å­¦é™¢).

# P1-6    Introduction of R-----------------------------------------------------

# æ•°æ®é‡‡é›† -> æ•°æ®æŒ–æ˜ï¼ˆData miningï¼‰
#   - ä¸‰ä¸ªç‰¹ç‚¹
#     - æ•°æ®æ•´ä½“æ€§
#     - ä¸è¿½æ±‚ç²¾ç¡®æ€§
#     - å› æœå…³ç³»ï¼ˆxï¼‰
#     - ç›¸å…³æ€§ï¼ˆâˆšï¼‰
#   - é€šè¿‡ç®—æ³•å‘ç°æ–°ä¸œè¥¿ï¼ˆè§„å¾‹ï¼‰-> ç›¸åŒæ•°æ®ä¸åŒç»“æœ -> ç»“æœå¯è§†åŒ–ï¼ˆæ•°æ®å»æŠ½è±¡åŒ–ï¼‰ 
#     -> å†³ç­–

# Rè¯­è¨€ç‰¹ç‚¹
#   - ç¼–ç¨‹å¼€æºï¼ˆå¤§é‡æ‹“å±•åŒ…ï¼‰
#   - ç»˜å›¾åŠŸèƒ½
#   -  é¢å‘å¯¹è±¡
#   - ä¸å¤Ÿè§„èŒƒã€ä¸æ”¯æŒå¤šçº¿ç¨‹
#   - å‡½æ•°åå¿…é¡»æ¥æ‹¬å·

getwd()
# çœ‹è·¯å¾„

df <- read.table("dataname.cvs", sep=",", header = T)
# dfå°†æ•°æ®æ–‡ä»¶å‘½å
# read.table()è¯»å†™Excelæ•°æ®æ–‡ä»¶
# sep=","æ¥è¡¨ç¤ºç©ºæ ¼ç”¨å­—ç¬¦

table(df$supp, df$dose)
# table()ç”¨äºåˆ¶ä½œæ–°è¡¨æ ¼ï¼Œ$ç”¨äºç»Ÿè®¡æ€»é‡
# aggregate()æµ‹é‡å‡å€¼ã€æ–¹å·®ç­‰



# P7-14   Rçš„å®‰è£…--------------------------------------------------------------

# - ç”¨ "<-" èµ‹å€¼ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡
# - ç”¨ "<<-" èµ‹å€¼ç»™ä¸€ä¸ªå…¨å±€å˜é‡
# - "<-"çš„å¿«æ·é”®ï¼šalt + - 

mean()
# mean(1:5) -> 3 æ±‚1-5çš„å¹³å‡æ•°
# mean(1,2,3,4,5) -> 1 åªè¾“å‡ºç¬¬ä¸€ä¸ªå‘é‡ï¼ˆ1ï¼‰çš„å¹³å‡æ•°ï¼Œåé¢ä¸ºæ— æ•ˆè¾“å…¥
# mean(c(1,2,3,4,5)) -> 3 å¢åŠ çš„c()å¸®åŠ©è¯†åˆ«ä¸€ä¸²æ•°å­—

ls()
# åˆ—å‡ºæ‰€æœ‰å˜é‡

ls.str()
# åˆ—å‡ºæ‰€æœ‰å˜é‡çš„è¯¦ç»†ä¿¡æ¯

str()
# æ‹¬å·é‡Œå¡«å†™å˜é‡åï¼Œè¾“å‡ºå˜é‡çš„ä¿¡æ¯

rm()
# æ¸…é™¤æŸä¸ªå˜é‡

rm(list = ls())
# æ¶ˆé™¤æ‰€æœ‰å˜é‡

history()
# å”¤å‡ºå†å²

save.image()
# ä¿å­˜å·¥ä½œç©ºé—´ï¼ˆå›¾ç‰‡ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼‰

# Ræ‹“å±•åŒ…å®‰è£…
# - åœ¨çº¿
#   é€šè¿‡è®¿é—®é•œåƒç«™ç‚¹
#   æ‹“å±•åŒ…çš„åå­—éƒ½éœ€è¦è¢«å¼•å·
    install.package()
    # eg. install.package("vcd")
    install.packages()
    # eg. install.packages(c("a", "b", "c"))
# - ç¦»çº¿ï¼ˆæºä»£ç ï¼‰
#   é•œåƒç«™ç‚¹ä¸‹è½½æºä»£ç 
#   éœ€è¦æ³¨æ„åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»

require()
# åŠ è½½åŒ…ï¼ˆeg. require(vcd)ï¼‰

detach() # eg. detach("package:vcd")
remove.packages() # eg. remove.packages("vcd")
# å»é™¤åŒ…

installed.packages()
# å¯ç”¨äºæ‹“å±•åŒ…ç§»æ¤ï¼Œæ¯”å¦‚ï¼š

# è€è®¾å¤‡
Rpack <- installed.packages() [,1] # Rpackèµ‹å€¼æ‰€æœ‰æ‹“å±•åŒ…çš„åå­—
save(Rpack, file = "Rpack.Rdata") # ä¿å­˜æ–‡ä»¶

# æ–°è®¾å¤‡
for (i in Rpact) install.packages(i)

# ?å‡½æ•°åï¼ˆä¸€ä¸ªé—®å·æŸ¥å‡½æ•°ï¼‰eg. ?mean
# ??å‡½æ•°åï¼ˆä¸¤ä¸ªé—®å¥½æŸ¥æ‹“å±•åŒ…ï¼‰eg. ??heatmap

apropos(å…³é”®å­—)
# æŸ¥è¯¢æ‹¬å·å†…çš„å…³é”®å­—

RSiteSearch("å…³é”®å­—")
# åœ¨Rç½‘å€æŸ¥è¯¢å…³é”®å­— rseek.org

# R -> å¤§æ•°æ® -> æ‰¹é‡åŒ–ã€è‡ªåŠ¨åŒ–
# Excel -> é¼ æ ‡æ“ä½œæ–¹ä¾¿



# P15     Rå†…ç½®æ•°æ®é›†-----------------------------------------------------------

# - å­˜åœ¨datasetsåŒ…ä¸­
# - data()è¾“å‡ºæ‰€æœ‰åŒ…å«çš„æ•°æ®é›† æˆ– data(package = "åŒ…å")
# - å¦‚æœæ•°æ®é‡Œé¢çš„æŸä¸ªå˜é‡è¢«é‡æ–°èµ‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨data("å˜é‡å")æ¥èµ‹å€¼å›æ•°æ®é›†é‡Œçš„å€¼

# å‘é‡ -> åç§°
# å› å­ -> åˆ†ç±»
# çŸ©é˜µã€æ•°ç»„ -> ä¸åŒä¸œè¥¿çš„ä¸åŒç±»å‹
# ç±»çŸ©é˜µã€æ•°æ®æ¡†

data.frame()
# åˆ¶ä½œæ•°æ®æ¡†

data(æ•°æ®é›†åç§°, package = "åŒ…å")
# åªåŠ è½½æ‹“å±•åŒ…é‡Œé¢çš„æ•°æ®é›†ï¼Œå¿½ç•¥åŒ…



# P16-26  æ•°æ®ç»“æ„ï¼ˆRå‚¨å­˜ç»„ç»‡æ•°æ®çš„æ–¹å¼ï¼‰---------------------------------------

#             1. å‘é‡ï¼ˆvectorï¼‰-------------------------------------------------
    
    # - ç”¨å‡½æ•°c()æ¥åˆ›å»ºå‘é‡ï¼ˆæ•°ç»„ï¼‰
    # - é€»è¾‘å‹å‘é‡ï¼šTRUE(T) OR FALSE(F)
    # - è¾“å‡ºç­‰å·®æ•°åˆ—
        seq(from = èµ·å§‹æ•°, to = ç»“å°¾æ•°, by = é—´éš”, length.out = è¾“å‡ºæ•°é‡)
    # - é‡å¤è¾“å‡º
        rep(æ•°ç»„, æ¬¡æ•°)
    # - ä¸€ä¸ªæ•°ç»„é‡Œé¢çš„å‘é‡å¿…é¡»æ˜¯åŒä¸€ç±»å‹
        # > c(1, 2, "three")
        #   "1" "2" "three" # å¯¼è‡´å‰é¢çš„æ•°å­—å‘é‡å…¨éƒ¨å˜æˆå­—ç¬¦ä¸²
    # - å‘é‡åŒ–ç¼–ç¨‹å¯ä»¥çœç•¥å¾ªç¯ï¼Œæ¯”å¦‚ï¼š
        # > x <- c(1, 2, 3, 4, 5)
        # > y <- c(6, 7, 8, 9, 10)
        # > x * z + y
        #   8 11 14 17 20
    # - ä½¿ç”¨c()æ¥æ§åˆ¶å¾ªç¯çš„æ¬¡æ•°
        # > x <- c(1, 2, 3, 4, 5)
        # > rep(x, c(2, 4, 1, 1, 3))
        #   1 1 2 2 2 2 3 4 5 5 5
    # - å‘é‡ç´¢å¼•
        length(æ•°ç»„) # æ•°ç»„æ•°é‡
        æ•°ç»„[ä½ç½®] # è¾“å‡ºæ•°ç»„æŸä¸ªå‘é‡
        æ•°ç»„[-ä½ç½®] # è¾“å‡ºé™¤äº†é€‰ä¸­ä½ç½®å…¶ä½™çš„æ‰€æœ‰å‘é‡
        append() # ä½¿ç”¨appendä¸ä¼šmutateç”¨æ¥çš„å‘é‡
    # - å‘é‡è¿ç®—
        x ** y # x^y
        x %% y # x/yçš„ä½™æ•°
        x %/% y # x/yçš„æ•´æ•°éƒ¨åˆ†ï¼ˆæ•´é™¤ï¼‰
        # å¾ªç¯ï¼š
        # å‘é‡ä¸ªæ•°ä¸åŒä¹Ÿå¯èƒ½å¯ä»¥ç›¸åŠ ï¼Œä½†é•¿çš„å‘é‡ä¸ªæ•°å¿…é¡»æ˜¯çŸ­çš„å‘é‡ä¸ªæ•°çš„æ•´é™¤æ•°ã€‚
        # æƒ³è¦å¯¹æ¯”ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåº”ç”¨ä¸¤ä¸ªç­‰å·==ï¼ˆä¸€ä¸ªç­‰å·ç›¸å½“äºèµ‹å€¼ï¼‰
        
        abs() # ç»å¯¹å€¼
        sqrt() # å¹³æ–¹æ ¹
        log(å‘é‡, base = logçš„åº•æ•°) # ä¸åŠ baseé»˜è®¤åº•æ•°æ˜¯e
        log10() # baseæ˜¯10çš„log
        exp() # ä»¥eä¸ºåº•çš„æŒ‡æ•°
        ceiling() # å‘ä¸Šå–æ•´
        floor() # å‘ä¸‹å–æ•´
        trunc() # å‘é‡å†…å–æ•´
        
        # å››èˆäº”å…¥
        round(å‘é‡, digits = ä¿ç•™å°æ•°ç‚¹ä½æ•°)
        signif(å‘é‡, digits = æ€»ä¿ç•™ä½æ•°)
        
        # ä¸‰è§’å‡½æ•°
        sin()
        cos()
        tan()

        # ç»Ÿè®¡å‡½æ•°
        sum() # æ±‚å’Œ
        max() # æœ€å¤§å€¼
        min() # æœ€å°å€¼
        range() # æœ€å¤§ã€å°å€¼
        mean() # å‡å€¼
        var() # æ–¹å·®ï¼ˆvarianceï¼‰
        sd() # æ ‡å‡†å·®ï¼ˆstandard deviationï¼‰
        prod() # è¿ä¹˜çš„ç§¯
        median() # ä¸­ä½æ•°
        quantile(å‘é‡, ç™¾åˆ†æ¯”combine) # é»˜è®¤å››åˆ†ä½æ•°
        # ç´¢å¼•å€¼
        which.max() # å‘é‡ä¸­æœ€å¤§å€¼çš„ä½ç½®
        which.min() # å‘é‡ä¸­æœ€å°å€¼çš„ä½ç½®
        which(å‘é‡==ç›®æ ‡å€¼) # ç›®æ ‡å€¼åœ¨å‘é‡ä¸­çš„ä½ç½®


#             2. çŸ©é˜µä¸æ•°ç»„ï¼ˆmatrixï¼‰-------------------------------------------
    
    # ï¼ˆå¤šç»´çš„å‘é‡ï¼‰
    matrix(å‘é‡, nrow = è¡Œæ•°, ncol = åˆ—æ•°, byrow = T/F) # åˆ¶ä½œä¸€ä¸ªçŸ©é˜µ
    # å‘é‡çš„ä¸ªæ•°å¿…é¡»å¤§äºæˆ–ç­‰äºmatrixçš„æ ¼æ•°ï¼ˆè¡Œæ•° x åˆ—æ•° <= å‘é‡æ•°ï¼‰
    # Data length must be a sub-multiple or multiple of the number of rows
    # byrow = T æ—¶matrixå…ˆå¡«è¡Œï¼Œå†å¡«åˆ—ï¼Œåä¹‹äº¦ç„¶
    
    dimnames(matrix) <- list(è¡Œåé›†, åˆ—åé›†)
    # å¦‚ä½•åŠ è¡Œã€åˆ—å
    
    dim(å‘é‡) # è¾“å‡ºå‘é‡çš„ç»´åº¦ï¼Œä¹Ÿå¯ç›´æ¥èµ‹å€¼æ¥æ”¹å˜å‘é‡çš„ç»´åº¦
    # > dim(x) # x = c(1, 2)
    #   NULL
    # > dim(x) <- c(1, 2)
    # >  x
    #       [,1] [,2]
    #   [,1]  1   2

    # æ•°ç»„ï¼ˆæ›´å¤šç»´ï¼‰
    array(å‘é‡, ç»´æ•°é›†, dimnames = ç»´åº¦åçš„list)
    # eg. array(1:6, c(1, 2, 3)æŒ‡1è¡Œ2åˆ—3å±‚, dimnames = list(c("A1"), 
    #                                                     c("B1", "B2"),  
    #                                                     c("C1", "C2", "C3")))

    # çŸ©é˜µç´¢å¼•
    matrix[è¡Œæ•°, åˆ—æ•°] # åˆ—æ•°å’Œè¡Œæ•°ä¸ä¸€å®šåªæ˜¯ä¸€ä¸ªæ•°ï¼Œå¯ä»¥æ˜¯ä¸ªé›†
    matrix[è¡Œæ•°] # è®¿é—®è¡Œæ•°çš„ç¬¬ä¸€åˆ—
    matrix[è¡Œæ•°,] # è®¿é—®è¡Œæ•°çš„å…¨åˆ—
    matrix[-è¡Œæ•°, åˆ—æ•°] # è®¿é—®é™¤äº†åˆ¶å®šè¡Œæ•°çš„å…¨éƒ¨è¡Œæ•°
    matrix["è¡Œå", "åˆ—å"] # å¦‚æœmatrixå·²æœ‰è¡Œã€åˆ—åï¼Œä¹Ÿå¯ç›´æ¥ç”¨è¡Œã€åˆ—åç´¢å¼•
    
    # çŸ©é˜µè¿ç®—
    # è¡Œåˆ—ä¸ä¸€è‡´çš„ä¸¤ä¸ªçŸ©é˜µæ— æ³•ç›¸åŠ å‡
    rowSums(matrix) # matrixæ¯ä¸€è¡Œçš„å’Œ
    colSums(matrix) # matrixæ¯ä¸€åˆ—çš„å’Œ
    rowMeans() # matrixæ¯ä¸€è¡Œçš„å¹³å‡æ•°
    colMeans() # matrixæ¯ä¸€åˆ—çš„å¹³å‡æ•°
    matrix1 * matrix2 # å†…ç§¯
    matrix1 %*% matrix2 # å¤–ç§¯
    diag(matrix) # matrixçš„å¯¹è§’çº¿å€¼
    t(matrix) # matrixçš„è¡Œåˆ—äº’æ¢


#             3. åˆ—è¡¨ï¼ˆlistï¼‰---------------------------------------------------
    
    list(ç¬¬ä¸€å¯¹è±¡å = ç¬¬ä¸€ä¸ªå¯¹è±¡, ç¬¬äºŒå¯¹è±¡å = ç¬¬äºŒä¸ªå¯¹è±¡, ...)
    # åˆ¶ä½œåˆ—è¡¨

    # è®¿é—®å•ä¸ªå¯¹è±¡
    åˆ—è¡¨å[å¯¹è±¡ä½ç½®]
    åˆ—è¡¨å["å¯¹è±¡å"] # è¿™é‡Œè®¿é—®éœ€è¦åŠ å¼•å·
    
    # è®¿é—®å¤šä¸ªå¯¹è±¡
    åˆ—è¡¨å[c(å¯¹è±¡1ä½ç½®, å¯¹è±¡2ä½ç½®, ...)]
    åˆ—è¡¨å[c("å¯¹è±¡1å", "å¯¹è±¡2å", ...)] 
    åˆ—è¡¨å$å¯¹è±¡å # ä¸€èˆ¬å¯¹è±¡åä¼šè‡ªåŠ¨ç»™
    
    # ***mlist[1]å’Œmlist[[1]]çš„åŒºåˆ«***
    mlist[1]
        # ç±»å‹ä¸ºlist
        # è¦åˆ å‡åˆ—è¡¨å¯ä»¥ä½¿ç”¨å•æ‹¬å·è´Ÿç´¢å¼•ï¼Œå¦‚ï¼šmlist[-2]ç­‰äºå»é™¤ç¬¬äºŒä¸ªlist
    mlist[[1]]
        # ç±»å‹ä¸ºä¸€å¼€å§‹ç»„æˆåˆ—è¡¨çš„å…ƒç´ ï¼Œå¦‚vectorã€matrixç­‰ï¼ˆä¹Ÿå¯èƒ½æ˜¯åˆ—è¡¨ï¼‰
        # æ‰€ä»¥è¦æ”¹æˆ–åŠ mlisté‡Œé¢çš„å…ƒç´ ï¼Œéœ€è¦ä¸¤ä¸ªæ‹¬å·
        # åˆ å‡åˆ—è¡¨å¯ä»¥æŠŠlisté‡Œé¢çš„å…ƒç´ èµ‹å€¼NULLï¼Œå¦‚mlist[[1]] <- NULL
    
    # åˆ å‡éƒ½ä¼šé€ æˆæ‰€æœ‰çš„æ•°æ®åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®å˜åŒ–
    

#             4. æ•°æ®æ¡†ï¼ˆæ•°æ®é›†ï¼‰-----------------------------------------------
    
    # - è¡Œï¼ˆrowï¼‰è¡¨ç¤ºè§‚æµ‹ï¼ˆobjectï¼‰
    # - åˆ—ï¼ˆcolumnï¼‰è¡¨ç¤ºå˜é‡ï¼ˆdoseï¼‰
    #       col1  col2  col3
    # row1
    # row2
    # row3

    # çŸ©é˜µå¿…é¡»ä¸ºåŒä¸€æ•°æ®ç±»å‹
    # æ•°æ®æ¡†æ¯ä¸€åˆ—å¿…é¡»åŒä¸€ç±»å‹ï¼Œä½†æ¯ä¸€è¡Œå¯ä»¥ä¸åŒã€‚
    
    data.frame(å˜é‡1, å˜é‡2, ...) # åˆ¶ä½œæ•°æ®æ¡†
    
    # è®¿é—®æ•°æ®æ¡†
    æ•°æ®é›†[åˆ—/"åˆ—å"] # å¯ä»¥ç”¨c()ä¸€æ­¥æŸ¥çœ‹å¤šåˆ—ï¼Œä¼šè¾“å‡ºä¸€ä¸ªå¸¦è¡Œçš„æ–°æ•°æ®æ¡†
    æ•°æ®é›†["è¡Œå",] # ä¸€è¡Œ + å…¨åˆ—
    æ•°æ®é›†[, "åˆ—å"] # å…¨è¡Œ + ä¸€åˆ—
    æ•°æ®é›†$åˆ—å # å…¨è¡Œ + ä¸€åˆ—
    with(æ•°æ®é›†, {åˆ—å}) # ç›´æ¥è¾“å‡ºå…¨åˆ—
    
    attach(æ•°æ®é›†) # æŠŠæ•°æ®é›†çš„åˆ—åå¯¼å…¥Rï¼Œä¹‹åå¯ä»¥ç›´æ¥è®¿é—®
    detach(æ•°æ®é›†) # æ¶ˆé™¤æ•°æ®é›†çš„åˆ—å
    
 
#             5. å› å­ï¼ˆfactorï¼‰-------------------------------------------------
    
    # å˜é‡ç±»å‹ï¼š
    #   - åä¹‰å‹ï¼ˆnominalï¼‰ï¼šæ— é¡ºåºçš„/é¡¹ç›®ä¹‹é—´æ˜¯ç‹¬ç«‹çš„/æ¯”å¦‚åå­—
    #   - æœ‰åºå‹ï¼ˆordinalï¼‰ï¼šé¡¹ç›®ä¹‹é—´æœ‰å…³è”ä½†ä¸æ˜¯è¿ç»­çš„æ•°é‡å˜åŒ–/æ¯”å¦‚poor, better, best
    #   - è¿ç»­å‹ï¼ˆcontinuousï¼‰ï¼šæœ‰é¡ºåºçš„/è¿ç»­çš„æ•°é‡å˜åŒ–/æ¯”å¦‚é‡‘é¢ã€å¢äº§ç‡ç­‰
    
    # åä¹‰å‹ï¼ˆnominalï¼‰å’Œæœ‰åºå‹ï¼ˆordinalï¼‰éƒ½å±äºå› å­
    # æ°´å¹³å€¼ï¼ˆlevelï¼‰æ„æˆçš„å‘é‡ä¸ºå› å­
    # å› å­çš„ä½œç”¨ï¼šè®¡ç®—æ¦‚ç‡å’Œé¢‘æ•°
    
    # factors      Lever 1     Level 2     Level 3
    # * $ &
    # * * *   ->    ****        $$          &&&
    # $ & &
    
    # å› å­å‹æ•°æ®
    factor(c(æ•°æ®é›†), orderred = T/F, levels = c("level1", "level2", ...))
    # ä¼šè¾“å‡ºæ•°æ®é›†å’Œlevelsçš„é¡ºåº
    
    # ç»˜å›¾ï¼ˆå› å­è¾“å‡ºæ¡å½¢å›¾ğŸ“Šï¼Œå‘é‡è¾“å‡ºæ•£ç‚¹å›¾ï¼‰
    
    # æ•£ç‚¹å›¾
    # ^ level
    # | 
    # |         ...
    # |     ...
    # | ...
    # |
    # ----------------> index
    
    # æ¡å½¢å›¾
    # ^ æ•°é‡
    # | 
    # |         ---
    # |     --- | |
    # | --- | | | |
    # | | | | | | |
    # ----------------> level
    
    # cut(è¢«åˆ†å‰²çš„å‘é‡, (æŠŠ0åˆ°100, æ€»levelæ•°é‡ä¸º10, ç­‰åˆ†10ä»½))
    cut(1:100, c(seq(0, 100, 10)))
    

#             6. ç¼ºå¤±æ•°æ®-------------------------------------------------------
    
    # - æµ‹é‡å€¼ä¸¢å¤±
    # - æ²¡æœ‰å€¼
    # - æ— æ•ˆå€¼
    
    # NAè¡¨ç¤ºç¼ºå¤±å€¼ï¼ˆNAä¸ä¸€å®šç­‰äºé›¶ï¼‰
    # > 1 + NA
    #   NA
    # > NA == 0
    #   NA
    
    # å‡½æ•°ä¸­å…³äºç¼ºå¤±å€¼çš„å‚æ•°
    na.rm = T/F # æ˜¯å¦ç§»é™¤ç¼ºå¤±å€¼ï¼ˆæ³¨ï¼šé€‰äº†Tåï¼Œå‡½æ•°è®¡ç®—ç›¸å½“äºç¼ºå¤±å€¼ä»æœªå‡ºç°ï¼‰
    
    # æ¶ˆé™¤å‘é‡ä¸­çš„NA
    na.omit(åŸå‘é‡) # å¦‚æœæ˜¯æ•°æ®é›†ä½¿ç”¨na.omit()ï¼Œä¼šæŠŠæœ‰NAçš„æ•´è¡Œéƒ½åˆ é™¤æ‰
    
    #å…¶ä»–ç¼ºå¤±æ•°æ®
  
    NaN # ä»£è¡¨ä¸å¯èƒ½çš„å€¼ï¼ˆæ¯”å¦‚0/0ï¼‰ï¼Œä¸å­˜åœ¨çš„ 
    is.nan() # æŸ¥è¯¢æ˜¯å¦ä¸ºNaN
    
    Inf # ä»£è¡¨æ­£æ— ç©·ï¼ˆ1/0ï¼‰
    -Inf # ä»£è¡¨è´Ÿæ— ç©·ï¼ˆ-1/0ï¼‰
    is.infinite() # æŸ¥è¯¢æ˜¯å¦ä¸ºæ— ç©·
    
    Na # æ˜¯å­˜åœ¨çš„ï¼Œä½†ä¸çŸ¥é“æ˜¯å¤šå°‘

    
#             7. å­—ç¬¦ä¸²ï¼ˆstring/strï¼‰-------------------------------------------
    
    # è¦åŠ å¼•å·ï¼
    
    nchar() # å‘é‡ä¸­æ¯ä¸ªå…ƒç´ ï¼ˆå­—ç¬¦ä¸²ï¼‰çš„é•¿åº¦
    length() # å‘é‡ä¸­å…ƒç´ çš„ä¸ªæ•°
    
    paste()
    # > paste(c("a", "b", "c"))
    #   "a" "b" "c" # å› ä¸ºc()ï¼Œä¸‰ä¸ªå‘é‡ä¸åœ¨ä¸€ä¸ªç»´åº¦ï¼Œåˆ†åˆ«å¤„ç†
    # > paste("a", "b", "c")
    #   "a b c" # é»˜è®¤æ˜¯ç©ºæ ¼åˆ†å‰²
    # > paste("a", "b", "c", sep="-")
    #   "a-b-c" # sepä¸ºåˆ†å‰²å‚æ•°
      
    substr(å‘é‡, start = ç¬¬ä¸€ä¸ªå­—ç¬¦, stop = æœ€åçš„å­—ç¬¦) # ç”¨äºæå–éƒ¨åˆ†å­—ç¬¦
    
    toupper() # å…¨å¤§å†™
    tolower() # å…¨å°å†™
    
    # ç”¨äºåˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ä¸æ˜¯å‘é‡
    strsplit(å­—ç¬¦ä¸²å‘é‡/é›†, "åˆ†éš”ç¬¦") 
    
    # å¯¹å‘é‡1å’Œå‘é‡2ä½¿ç”¨åˆ¶å®šå‡½æ•°
    outer(å‘é‡1, å‘é‡2, FUN = å‡½æ•°å)
      

#             8. æ—¥æœŸå’Œæ—¶é—´ï¼ˆdateï¼‰---------------------------------------------
    
    # å¯¹æ—¶é—´åºåˆ—çš„æè¿°
    # åˆ©ç”¨å‰é¢çš„ç»“æœè¿›è¡Œé¢„æµ‹
    
    "ts" # time series æ—¶é—´æ•°æ®çš„ç®€ç§°
    # tsä¸æ˜¯æ•°æ®æ¡†
    
    Sys.Date() # æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´
    
    as.Date(å‘é‡, format = "%Y-%m-%d")
    # ä¾‹å­
    a <- "2020-01-01"
    class(a) # "character"
    class(as.Date(a)) # "Date"
    
    ?strftime # æ—¶é—´å‡½æ•°ç›¸å…³ä»‹ç»
    
    seq(as.Date("2017-01-01"), as.Date("2017-07-05"), by=5)
    # byå‚æ•°ä¸ºç›¸éš”å¤©æ•°ï¼ˆä»èµ·å§‹å¼€å§‹ï¼Œæ¯éš”byå¤©å‡ºä¸€ä¸ªæ•°ï¼‰
    
    ts(data, 
        start = c(èµ·å§‹å¹´, èµ·å§‹å¹´çš„ç¬¬å‡ ä¸ªé¢‘ç‡å•ä½), 
        end = c(ç»ˆæ­¢å¹´, ç»ˆæ­¢å¹´çš„ç¬¬å‡ ä¸ªé¢‘ç‡å•ä½), 
        frequency = é¢‘ç‡æ•°)
    # Creating time-series objects
    # frequencyé¢‘ç‡å˜åŒ–ï¼š
      # 1 ä»¥å¹´ä¸ºå•ä½
      # 12 ä»¥æœˆä»½ä¸ºå•ä½
      # 4 ä»¥å­£åº¦ä¸ºå•ä½
    # ä¾‹å­ï¼š
    
    # > sales <- round(runif(48, min=50, max=100))
    
    # > sales
    # [1] 56 75 75 85 51 73 63 79 73 88 57 81 72 85 58 60 87 77 55 86 65 71 50 91 64 63 59
    # [28] 60 64 82 75 81 60 75 95 50 75 87 79 85 57 50 62 86 52 72 98 97
    
    # > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 1) ä»¥å¹´ä¸ºå•ä½
    # Time Series:
    # Start = 2014 
    # End = 2017 
    # Frequency = 1 
    # [1] 56 75 75 85
    
    # å› ä¸ºfrequency=1ï¼Œæ‰€ä»¥èµ·å§‹ä¸ºä»2010å¼€å§‹ç®—çš„ç¬¬äº”å¹´ï¼Œå³2014å¹´ã€‚
    # ç»“æŸä¸º2014å¼€å§‹ç®—çš„ç¬¬å››å¹´ï¼Œå³2017å¹´ã€‚
    # 2014-2017ï¼Œæ€»4å¹´ï¼Œå¯ä»¥æœ‰å››ä¸ªæ•°æ®æŒ‡å‘æ—¶é—´ã€‚
    # å› ä¸ºå¯ä»¥fillçš„æ—¶é—´ä¸å¤Ÿï¼Œå¤šä½™çš„æ•°æ®å°±è¢«çœç•¥æ‰äº†ã€‚
    
    # > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 4) ä»¥å­£åº¦ä¸ºå•ä½
    #       Qtr1 Qtr2 Qtr3 Qtr4
    # 2011   56   75   75   85
    # 2012   51   73   63   79
    # 2013   73   88   57   81
    # 2014   72   85   58   60
    
    # 2010å¼€å§‹çš„ç¬¬äº”å­£åº¦ï¼Œå³2010ç¬¬ä¸€å­£åº¦ï¼›2014å¼€å§‹çš„ç¬¬å››å­£åº¦ï¼Œå³2014ç¬¬å››å­£åº¦ã€‚
    
    # > ts(sales, start = c(2010,5), end = c(2014,4), frequency = 12) ä»¥æœˆä»½ä¸ºå•ä½
    #       Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
    # 2010                  56  75  75  85  51  73  63  79
    # 2011  73  88  57  81  72  85  58  60  87  77  55  86
    # 2012  65  71  50  91  64  63  59  60  64  82  75  81
    # 2013  60  75  95  50  75  87  79  85  57  50  62  86
    # 2014  52  72  98  97                                
    

    
# P28     è·å–æ•°æ®--------------------------------------------------------------
    
    # 1. é”®ç›˜è¾“å…¥
    
    # Creating a dataframe
    patientID <- c(1, 2, 3, 4)
    admdate <- c("10/15/2009", "11/01/2009", "10/21/2009", "10/28/20009")
    age <- c(25, 34, 28, 52)
    diabetes <- c("Type1", "Type2", "Type1", "Type1")
    status <- c("Poor", "Improved", "Excellent", "Poor")
    data <- data.frame(patientID, age, diabetes, status) # æ•°æ®æ¡†
    #   patientID age diabetes    status
    # 1         1  25    Type1      Poor
    # 2         2  34    Type2  Improved
    # 3         3  28    Type1 Excellent
    # 4         4  52    Type1      Poor
    data2 <- data.frame(patientID = character(0), 
                          age = numeric(0), 
                          diabetes = character(0), 
                          status = character(0)) 
    data2 <- edit(data2) # å¯è§†ç¼–è¾‘å™¨
    fix(data2)
    
    
    # 2. è¯»å–å¤–éƒ¨æ–‡ä»¶
    
    
    # 3. è®¿é—®æ•°æ®åº“
    
    # ODBC = open database connectivity å¼€æ”¾æ•°æ®åº“
    install.packages("RODBC")
    # åŒå‘é€šä¿¡ï¼Œè¯»å†™å’Œå†™å…¥
    
    
    
    
# P29-30  è¯»å…¥æ–‡ä»¶--------------------------------------------------------------
    
    ?read.table()
    x <- read.table("input.txt") # é»˜è®¤ç©ºç™½åˆ†å‰²
    
    x <- read.table("input.csv", sep=",", header = T, skip = 5, nrows = 100, 
                    na.strings = " ") 
    # é€—å·åˆ†å‰²
    # ç¬¬ä¸€è¡Œæ˜¯å¦ä¸ºå˜é‡åç§°
    # skipçš„è¡Œæ•°
    # nrowsï¼šæ€»å…±å¯¼å…¥å¤šå°‘è¡Œ
    # è‡ªåŠ¨è½¬åŒ–ç¼ºå¤±å€¼
    
    head(x, n = 6) # æå–æœ€å¼€å§‹çš„å…­è¡Œï¼ˆé»˜è®¤å…­è¡Œï¼‰
    tail(x, n = 6) # æå–æœ€æœ«å°¾çš„å…­è¡Œ
    
    read.csv() # è¯»å–csvæ–‡ä»¶
    read.fwf() # fixed width file
    
    x <- read.table("website", header = T)
    
    install.packages("XML") # ç½‘ç»œè¯»å–æ•°æ®çš„åŒ…
    ?readHTMLTable
    
    install.packages("foreign") # è¯»å–ä¸åŒè½¯ä»¶æ ¼å¼çš„æ•°æ®çš„åŒ…
    help(package = "foreign")
    
    # Excelç›´æ¥å¤åˆ¶åˆ°å‰ªè´´æ¿å¯¼å…¥
    x <- read.table("clipboard", header = T, sep = "\t") # Windows
    x <- read.table(pipe("pbpaste")) # Mac
    
    read.table(gzfile("input.txt.gz")) # gz file
    
    ?readLines
    readLines("input.csv", n = 5) # n = è¿”å›è¡Œæ•°
    
    ?scan
    scan("input.txt", what = list(numeric(0)))
    scan("input.txt", what = list(X1 = character(3),
                                  X2 = numeric(0),
                                  X3 = numeric(0)))
    # æ•°å­—è¡¨ç¤ºè¯»å…¥çš„æ•°é‡ï¼Œ0è¡¨ç¤ºæ‰€æœ‰
    
    
# P31     å†™å…¥æ–‡ä»¶--------------------------------------------------------------
    
    ?write
    write.table(x, file = "x.txt")
    write.table(x, file = "x.csv", sep = "\t", quote = F, append = F, 
                na = "NA", row.names = F)
    # append = Fæ¸…ç©ºæºæ–‡ä»¶ï¼ˆTåŠ åœ¨åŸæ–‡ä»¶åï¼‰
    # row.nameså–æ¶ˆè‡ªåŠ¨æ·»åŠ çš„è¡Œå·
    
    write.csv
    
    
# P32     è¯»å†™Excelæ–‡ä»¶---------------------------------------------------------
    
    # Excelæ–‡ä»¶å¦å­˜ä¸ºcsvæ ¼å¼
    x <- read.csv()
    
    # å¤åˆ¶å‰ªè´´æ¿
    x <- read.table(pipe("pbpaste"))
    
    # Excelçš„æ ¼å¼ï¼š.xlsx
    
    # XLConnectåŒ…ï¼Œéœ€è¦JAVAç¯å¢ƒ
    install.packages("XLConnect") # éœ€è¦rJavaåŒ…
    x <- loadWorkbook("data.xlsx")
    readWorksheet(x, 1) # ä¸åŒçš„å·¥ä½œè¡¨ï¼Œæ•°å­—ä¸ºå·¥ä½œè¡¨ä½ç½®
    # å†™å…¥ï¼ˆå››æ­¥æ³•ï¼‰
    y <- loadWorkbook("file.xlsx", create = T)
    createSheet(y, "Sheet 1")
    writeWorksheet(y, data = x, sheet = "Sheet 1")
    saveWorkbook(y)
    # å†™å…¥ï¼ˆä¸€æ­¥æ³•ï¼‰
    writeWorksheetToFile("file.xlsx", data = x, sheet = "Sheet 1")
    
    # xlsxåŒ…ï¼Œéœ€è¦JAVAç¯å¢ƒ
    read.xlsx("data.xlsx", 1, startRow = 1, endRow = 100)
    write.xlsx(x, file = "data.xlsx", sheetName = "Sheet 1", append = T/F)
    
    # openxlsxåŒ…ï¼Œä¸ç”¨JAVAç¯å¢ƒ
    
    
# P33     è¯»å†™Ræ ¼å¼æ–‡ä»¶---------------------------------------------------------
    
    # .RDS -> R data set
    saveRDS(data, file = "data.RDS") # å‚¨å­˜ä¸ºRDSæ–‡ä»¶è‡³å…¬å…±ç›®å½•
    x <- readRDS("data.RDS") # è¯»å…¥RDSæ–‡ä»¶
    
    # .R
    
    # .RData
    load("data.RData")
    save(data1, data2, file = "data.RData")
    save.image()
    
    
# P34-40  æ•°æ®æ ¼å¼è½¬æ¢----------------------------------------------------------
    
    # æ·»åŠ ã€åˆ å‡ã€æ’åºæ•°æ®
    
    # æ•°æ®æ¡†
    is.data.frame(data)
    new.data <- as.data.frame(data) # å…¶ä»–æ•°æ®ç±»å‹è½¬æ¢ä¸ºæ•°æ®æ¡†
    
    method(is)
    method(as)
    
    unlist(list)
    
    # æ•°æ®å–å­é›†
    who <- read.csc("WHO.csv", header = T) # å¯¼å…¥æ•°æ®
    who1 <- who[c(1:50), c(1:10)] # å–å‰50è¡Œï¼Œ10åˆ—ï¼ˆæƒ³è¦çš„é‚£éƒ¨åˆ†ï¼‰
    who$Continent # ä½¿ç”¨åˆ—å
    who2 <- who[which(who$Continent == 7)] # ä½¿ç”¨whichå‡½æ•°æ¥å®šä½ï¼ˆé€»è¾‘åˆ¤æ–­ï¼‰
    who3 <- who[which(who$CountryID > 50 & who$CountryID <= 100)] # å¤šé‡é€»è¾‘
    ?subset
    who4 <- subset(who, who$CountryID > 50 & who$CountryID <= 100) # data, logic
    ?sample # éšæœºæå–éƒ¨åˆ†æ•°æ®
    x <- 1:100
    sample(x, n, replace = T/F) # nä¸ºè¾“å‡ºæ•°é‡ï¼Œreplaceä¸ºæ˜¯å¦å¯ä»¥é‡å¤
    who[sample(who$CountryID, 30, replace = F),] # éšæœºæŠ½å–CountryID 30ä¸ªå­é›†
    
    # åˆ é™¤å›ºå®šè¡Œ
    data[-1:-5] # è´Ÿç´¢å¼•
    data$row <- NULL # èµ‹å€¼NULL
    
    # æ•°æ®æ¡†åˆå¹¶->
    
    # åˆå¹¶åˆ—
    data.frame(d1, d2) # åˆ›é€ ä¸€ä¸ªæ–°çš„æ•°æ®æ¡†
    ?cbind
    cbind(d1, d2) # åœ¨ç¬¬ä¸€ä¸ªæ•°æ®æ¡†ä¸‹æ”¹
   
     # åˆå¹¶è¡Œï¼ˆd1å’Œd2åˆ—åå¾—ç›¸åŒï¼‰
    ?rbind
    rbind(d1, d2)
    
    # çŸ©é˜µä¹Ÿå¯ä»¥ç”¨cbindå’Œrbind
    
    # å»é™¤é‡å¤é¡¹ -> å–å­é›†
    duplicated(data)  
    data[duplicated(data),] # è¾“å‡ºé‡å¤éƒ¨åˆ†
    data[!duplicated(data),] # è¾“å‡ºéé‡å¤éƒ¨åˆ†
    unique(data) # ç›´æ¥å»é™¤é‡å¤æ•°æ®
    
    # ç¿»è½¬æ•°æ®æ¡†
    # Excelè½¬ç½®é€‰é¡¹
    # R
    new.data <- t(data) # è¡Œåˆ—ç¿»è½¬
    rev() # ç”¨äºå‘é‡
    data[rev(rownames(data)),] # å•ç¿»è½¬è¡Œï¼Œæ¯”å¦‚1->10å˜æˆ10->1
    
    # åˆ—è¿ç®—
    new.data <- data.frame(c1 = data$c1 * 2, c2 = data$c2) # ç»„æˆä¸€ä¸ªæ–°çš„æ•°æ®æ¡†
    transform(data, c1 = c1 * 2) # ç›´æ¥ä¿®æ”¹åŸæ•°æ®
    transform(data, c3 = c1 * 2) # åœ¨åŸæ•°æ®ä¸ŠåŠ ä¸€åˆ—æ–°æ•°æ®
    
    # æ•°æ®æ¡†çš„æ’åº->
    
    sort(data) # æ•°å­—ä»å°åˆ°å¤§ï¼Œå­—ç¬¦ä»aåˆ°zï¼ˆåªèƒ½ç”¨äºå‘é‡ï¼Œä¸èƒ½ç”¨äºæ•°æ®æ¡†ï¼‰
    data[sort(rownames(data)),] # ç”¨sortæ¥æ’åºæ•°æ®æ¡†çš„æ–¹æ³•ï¼ˆè¾“å‡ºæ–°æ•°æ®æ¡†ï¼‰
    
    order() # è¿”å›ç´¢å¼•å€¼
    data[order(data$target),] # æŒ‰ç…§targetåˆ—ä»å°åˆ°å¤§æ’åˆ—
    data[order(-data$target),] # æŒ‰ç…§targetåˆ—ä»å¤§åˆ°å°æ’åˆ—
    data[order(data$t1, data$t2),] # ä¸¤ä¸ªæ’åºæ¡ä»¶
    
    rank()
    
    
    # æ•°æ®æ¡†æ•°å­¦è¿ç®—->
    
    # for dataframe, matrix
    apply(data, MARGIN = 1, FUN = sum()) # è¡Œ
    apply(data, MARGIN = 2, FUN = mean()) # åˆ—
    
    lapply(list, FUN = length()) # for list
    sapply() # for vector, matrix
    tapply(data1, data2, FUN = length()) # for factor
    
    
    # applyç³»åˆ—å‡½æ•°->
    
    # åˆ†ç»„è®¡ç®—
    tapply() # å‚æ•°ï¼švector / è¿”å›å€¼ï¼švector
    apply() # å‚æ•°ï¼šlist, data.frame, array / è¿”å›å€¼ï¼švector, matrix
    
    # å¤šå‚æ•°è®¡ç®—
    mapply() # å‚æ•°ï¼švectorï¼Œä¸é™ä¸ªæ•° / è¿”å›å€¼ï¼švector, matrix
    
    # å¾ªç¯è¿­ä»£
    lapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼: list
        # ç®€åŒ–ç‰ˆ
        sapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼ï¼švector, matrix
            # å¯è®¾ç½®è¿”å›å€¼
            vapply() # å‚æ•°ï¼šlist, data.frame / è¿”å›å€¼ï¼švector, matrix
        # é€’å½’ç‰ˆ
        rapply() # å‚æ•°ï¼šlist / è¿”å›å€¼ï¼šlist
        
    # ç¯å¢ƒç©ºé—´éå†
    eapply() # å‚æ•°ï¼šenvironment / è¿”å›å€¼ï¼šlist
    
    
    # Centering and standardization ä¸­å¿ƒåŒ–ä¸æ ‡å‡†åŒ–->
    
    # ä¸­å¿ƒåŒ–ï¼ˆæ–¹å·®ï¼‰ï¼šdata setä¸­çš„å„é¡¹æ•°æ®å‡å»data setçš„å‡å€¼
    # æ ‡å‡†åŒ–ï¼ˆæ ‡å‡†å·®ï¼‰ï¼šä¸­å¿ƒåŒ–ä¹‹ååœ¨é™¤ä»¥data setçš„æ ‡å‡†å·®ï¼Œå³data setä¸­çš„å„é¡¹æ•°æ®å‡å»data setçš„å‡å€¼å†é™¤ä»¥data setçš„æ ‡å‡†å·®
    # ä½¿ä¸åŒç±»å‹æ•°æ®å¤§å°æ¥è¿‘
    # å…ˆä¸­å¿ƒåŒ–ï¼Œæ•°æ®å·®è¿˜æ˜¯å¤§çš„è¯å†æ ‡å‡†åŒ–
    # ä¸­å¿ƒåŒ–ï¼š
    x - mean(x)
    # æ ‡å‡†åŒ–ï¼š
    (x - mean(x)) / sd(x)
    
    scale(x, center = T/F, scale = T/F)
    # å‚æ•°center = Tä¸ºä¸­å¿ƒåŒ–å¤„ç†
    # å‚æ•°scale = Tä¸ºæ ‡å‡†åŒ–å¤„ç†
    
    # ä¸­å¿ƒåŒ–å’Œæ ‡å‡†åŒ–åï¼Œç»˜åˆ¶heat mapåŒºåˆ«ä¼šæ›´åŠ æ˜æ˜¾
    
    
    # reshape2åŒ…->
    x <- data.frame(k1 = c(NA,NA,3,4,5), k2 = c(1,NA,NA,4,5), data = 1:5)
    y <- data.frame(k1 = c(NA,2,NA,4,5), k2 = c(NA,NA,3,4,5), data = 1:5)
    merge(x, y, by = "k1")
    merge(x, y, by = c("k1", "k2"))
    
    install.packages("reshape2")
    melt(data) # å¯ä»¥æŠŠå®½æ•°æ®å˜æˆé•¿æ•°æ®ï¼Œåˆ—åå˜ä¸ºå› å­
    melt(data, id.vars = ) # id.vars æ˜¯è§‚æµ‹æ’åºçš„å‚æ•°
    
    dcast(data, month+day ~variable) # é‡é“¸æ•°æ®ï¼Œä»¥monthå’Œdayåˆ—ä¸ºæ’åº
    dcast(data, month ~ variable, fun.aggregate = sum, na.rm = T)
    # å•ä»¥monthä¸ºæ’åˆ—å‚æ•°ä¼šæœ‰å¾ˆå¤šè¡Œæœ‰ç›¸åŒä¼˜å…ˆå€¼
    # æ‰€ä»¥fun.aggregateçš„å‡½æ•°ç”¨æ¥æŠŠæœ‰ç€ç›¸åŒmonthçš„æ•°æ®è¿è¡Œä¸€ä¸ªè®¾å®šçš„å‡½æ•°
    
    
    # tidyråŒ…ï¼ˆTidy dataï¼‰->
    
    install.packages("tidyr")
    # ä¸èƒ½æœ‰ä¸¤ä¸ªç›¸åŒè¡Œåå’Œåˆ—åçš„unit
    
    # å®½å˜é•¿
    gather(data, key = "Key", value = "Value", factor1, factor2, facotr3)
    # factorå…¶å®å°±æ˜¯åˆ—ï¼ŒæŠŠæ¯ä¸€åˆ—å˜æˆä¸€ç§å› å­
    gather(data, key = "Key", value = "Value", 2:4) # å¯ä»¥ç›´æ¥è¾“å…¥åˆ—çš„ç¼–å·
    
    # é•¿å˜å®½
    spread(data, key = "Key", value = "Value") # gatherçš„åå‡½æ•°
    # ä¼šè‡ªåŠ¨æŠŠkeyé‡Œé¢ä¸åŒçš„å› å­å˜ä¸ºä¸åŒçš„åˆ—å
    
    df <- data.frame(x = c(NA, "a.b", "b.c", "a.d"))
    separate(df, col = x, into = c("c1", "c2")) # ä¼šè‡ªåŠ¨è¯†åˆ«åˆ†å‰²ç¬¦
    df <- data.frame(x = c(NA, "a.b-c", "b-c", "a-d"), sep="-") # æœ‰å¤šä¸ªåˆ†å‰²ç¬¦ä½¿éœ€è¦æ ‡æ˜
    
    unite(x, col = "united col", c1, c2, sep="-")
    # separateçš„åå‡½æ•°ï¼ŒæŠŠä¸¤åˆ—è¿èµ·æ¥ï¼Œéœ€è¡¨æ˜è¿ç½®ç¬¦
    
    
    # dplyråŒ…->
    install.packages("dplyr")
    
    dplyr::filter(data, c2 > 10) # filteræ‰ä¸ç¬¦åˆåé¢é€»è¾‘çš„è¡Œ
    
    dplyr::distinct(rbind(data[1:10,], data[1:15,])) # distinctå»æ‰é‡å¤çš„åè¡Œ
    
    dplyr::slice(data, 10:15) # å–å‡ºåˆ¶å®šè¡Œ
    
    dplyr::sample_n(data, n) # éšæœºå–å‡ºnè¡Œ
    dplyr::sample_frac(data, 0.1) # æŒ‰å‡ ç‡å–å‡ºè¡Œ
    
    dplyr::arrange(data, c2) # æŒ‰ç…§æŸä¸€åˆ—çš„å¤§å°æ¥æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰
    dplyr::arrange(data, desc(c2)) # æŒ‰ç…§æŸä¸€åˆ—ç›¸åçš„å¤§å°æ¥æ’åºï¼ˆä»å¤§åˆ°å°ï¼‰
    
    select()
    
    # ç»Ÿè®¡å‡½æ•°
    summarise(data, avg = mean(c2))
    summarise(data, sum = sum(c2))
    
    # é“¾å¼æ“ä½œç¬¦ %>%ï¼ˆç®¡é“ï¼‰
    # ç”¨äºå®ç°å°†ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚
    # å¿«æ·é”®ï¼šctrl + shift + M
    # ç›¸å½“äºâ€œç„¶åâ€
    # ä¾‹å­ï¼š
    head(data, 20) %>% tail(10)
    # å…ˆå–å‡ºdataçš„å‰äºŒåè¡Œï¼Œå†ä»è¿™äºŒåè¡Œé‡Œé¢å–å‡ºæœ€åçš„åè¡Œï¼Œæ‰€ä»¥æœ€ç»ˆè¾“å‡ºä¸º11-20è¡Œã€‚
    
    dplyr::group_by(data, c5) # é€šè¿‡åˆ¶å®šåˆ—çš„å› å­æ¥è¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸€ç§å› å­ä¸ºä¸€ç»„ã€‚
    data %>% group_by(c5) # å¦ä¸€ç§å†™æ³•
    data %>% group_by(c5) %>% summarise(avg = mean(c2)) %>% arrange((avg))
    # å…ˆåˆ†ç»„ï¼Œå†ç®—å¹³å‡å€¼ï¼Œå†æ’åº
    
    dplyr::mutate(data, new=c2+c3) # åŠ æ–°çš„ä¸€åˆ—ï¼Œå¹¶æ·»åŠ é€»è¾‘
    
    # åŒè¡¨æ ¼æ•´åˆ
    
    a <- data.frame(x1 = c("A","B","C"), x2 = c(1,2,3))
    b <- data.frame(x1 = c("A","B","D"), x2 = c(T,F,T))
    dplyr::left_join(a, b, by="x1") # x1ä»¥ç¬¬ä¸€ä¸ªæ•°æ®æ¡†ä¸ºå‡†
    #   x1 x2.x  x2.y
    # 1  A    1  TRUE
    # 2  B    2 FALSE
    # 3  C    3    NA
    dplyr::right_join(a, b, by="x1") # x1ä»¥ç¬¬äºŒä¸ªæ•°æ®æ¡†ä¸ºå‡†
    #   x1 x2.x  x2.y
    # 1  A    1  TRUE
    # 2  B    2 FALSE
    # 3  D   NA  TRUE   # å› ä¸ºaçš„x1æ²¡æœ‰Dï¼Œæ‰€ä»¥x2.xæ˜¯NA
    dplyr::full_join(a, b, by="x1") # æŠŠæ‰€æœ‰å¯èƒ½éƒ½åˆ—å‡ºæ¥äº†
    #   x1 x2.x  x2.y
    # 1  A    1  TRUE
    # 2  B    2 FALSE
    # 3  C    3    NA
    # 4  D   NA  TRUE
    dplyr::semi_join(a, b, by="x1") # åˆ—å‡ºaï¼Œbéƒ½æœ‰çš„å¯èƒ½
    #   x1 x2
    # 1  A  1
    # 2  B  2
    dplyr::anti_join(a, b, by="x1") # åˆ—å‡ºaï¼Œbçš„ä¸åŒè¡Œ
    #   x1 x2
    # 1  C  3
    
    intersect(data1, data2) # å–äº¤é›†
    dplyr::union_all(data1, data2) # å–å¹¶é›†
    dplyr::union(data1, data2) # å–éå†—ä½™çš„å¹¶é›†
    setdiff(data1, data2) # å–data1çš„è¡¥é›†
    
    
    
# P41     Rå‡½æ•°-----------------------------------------------------------------
    
    # ä¾‹å­ï¼š
    state <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
    fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = state)    
    summary(fit)
    
    # å‡½æ•°çš„è¿”å›å€¼
    # ä¸€äº›æœ‰è¿”å›ï¼Œä¸€äº›æ²¡æœ‰
    
    # ç»˜å›¾å‡½æ•°è¾“å‡ºå›¾å½¢
    
    # å‘é‡
    sum()
    mean()
    sd()
    range()
    median()
    sort()
    order()
    
    # çŸ©é˜µæˆ–æ•°æ®æ¡†
    rbind()
    cbind()
    
    # æ•°å­—çŸ©é˜µ
    heatmap()
    
    # å¯ä»¥ä½¿ç”¨help()æ¥çœ‹ä¸æ‡‚çš„å‡½æ•°
    
    
# P42     é€‰é¡¹å‚æ•°--------------------------------------------------------------
    
    ls("package:base")
    par()
    
    # è§„å¾‹
    
    # 1. è¾“å…¥æ§åˆ¶éƒ¨åˆ†
      # å¯ä»¥è¾“å‡ºå“ªç§ç±»å‹çš„æ•°æ®
      # fileï¼šæ¥ä¸€ä¸ªæ–‡ä»¶
      # dataï¼šä¸€èˆ¬æŒ‡è¦è¾“å…¥ä¸€ä¸ªæ•°æ®æ¡†
      # xï¼šä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯å‘é‡ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯çŸ©é˜µæˆ–è€…åˆ—è¡¨
      # xå’Œyï¼šå‡½æ•°éœ€è¦ä¸¤ä¸ªè¾“å…¥å˜é‡
      # x, y, zï¼šå‡½æ•°éœ€è¦ä¸‰ä¸ªè¾“å…¥å˜é‡
      # formulaï¼šå…¬å¼
      # na.rmï¼šæ˜¯å¦åˆ é™¤ç¼ºå¤±å€¼
      # ...è¡¨ç¤ºå‚æ•°å¯ä¼ é€’ï¼Œæˆ–æ²¡æœ‰æ•°é‡é™åˆ¶
      # ~ è¡¨ç¤ºç›¸å…³
    
    # 2. è¾“å‡ºæ§åˆ¶éƒ¨åˆ†
    
    # 3. è°ƒèŠ‚éƒ¨åˆ†
      # ï¼ˆ1ï¼‰æ ¹æ®åå­—åˆ¤æ–­é€‰é¡¹çš„ä½œç”¨ï¼š
          # coloré€‰é¡¹ï¼šæ§åˆ¶é¢œè‰²
          # select ä¸é€‰æ‹©æœ‰å…³
          # font ä¸å­—ä½“æœ‰å…³
          # font.axis åæ ‡è½´çš„å­—ä½“
          # lty = line type
          # lwd = line width
          # method è½¯ä»¶ç®—æ³•
      # ï¼ˆ2ï¼‰é€‰é¡¹æ¥å—å“ªäº›å‚æ•°ï¼š
          # mainï¼šå­—ç¬¦ä¸²ï¼Œä¸èƒ½æ˜¯å‘é‡
          # na.rmï¼šTRUE or FALSE
          # axisï¼šsideå‚æ•°åªèƒ½æ˜¯1åˆ°4
          # figï¼šåŒ…å«å››ä¸ªå…ƒç´ çš„å‘é‡
          # ä¸å–å€¼å¯èƒ½æ˜¯NULLæˆ–è€…NA
          # methodå‚æ•°ä¸ç®—æ³•ç›¸å…³
        
    
# P43     æ•°å­¦ç»Ÿè®¡å‡½æ•°----------------------------------------------------------
    
    # æ¦‚ç‡å‡½æ•°
    
    # Ræ¦‚ç‡åˆ†å¸ƒ
      # d æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆdensityï¼‰
      # p åˆ†å¸ƒå‡½æ•°ï¼ˆdistributionï¼‰
      # q åˆ†å¸ƒå‡½æ•°çš„åå‡½æ•°ï¼ˆquantumï¼Ÿï¼‰
      # r äº§ç”Ÿç›¸åŒåˆ†å¸ƒçš„éšæœºæ•°ï¼ˆrandomï¼‰
    
    # æ­£æ€åˆ†å¸ƒ
    dnorm()
    pnorm()
    qnorm()
    rnorm()
    
    # ç¦»æ•£åˆ†å¸ƒ
    
    x <- rnorm(n=100, mean=15, sd=2)
    qqnorm(x)
    
    # ç”Ÿäº§éšæœºæ•°
    runif(n) # ç”Ÿäº§nä¸ª0-1çš„éšæœºæ•°
    runif(n, min = 1, max = 100) # min/maxå‚æ•°è®¾ç½®èŒƒå›´
    round(runif(n, min = 1, max = 100)) # ä½¿ç”¨roundç”Ÿæˆæ•´æ•°
    dgamma()
    
    # éšæœºæ•°ç§å­
    set.seed(n) # æ¯æ¬¡è¿è¡Œå¯ä»¥ä½¿ä¹‹åçš„éšæœºæ•°ç›¸åŒï¼Œnä¸ºç§å­ç¼–ç 
    
    
# P44     æè¿°æ€§ç»Ÿè®¡å‡½æ•°--------------------------------------------------------
    
    # summary()æä¾›å‘é‡çš„å„é¡¹æ•°æ®ï¼Œæ¯”å¦‚æœ€å¤§å°å€¼ã€å¹³å‡å€¼ã€å››åˆ†ä½æ•°ã€å› å­é¢‘æ•°å‘é‡ç»Ÿè®¡ç­‰
    myvars <- mtcars[c("mpg", "hp", "wt", "am")]
    summary(myvars)
    
    fivenum(myvars$hp)
    # è¿”å›äº”ä¸ªæ•°ï¼šæœ€å°å€¼ã€å››åˆ†ä½æ•°ç¬¬ä¸€ã€ä¸­ä½æ•°ã€å››åˆ†ä½æ•°ç¬¬ä¸‰ã€æœ€å¤§å€¼
    
    # Descriptive stats via describe (Hmisc)
    install.packages("Hmisc")
    library(Hmisc)
    myvars <- c("mpg", "hp", "wt")
    describe(mtcars{myvars})
    
    # Descriptive stats via stat.desc (pastecs)
    install.packages("pastecs")
    library(pastecs)
    stat.desc(mtcars{myvars})
    stat.desc(mtcars, basic = T, desc = T, norm = T)
    # basic = T è®¡ç®—åŸºæœ¬å€¼
    # desc = T è®¡ç®—æè¿°å€¼
    # norm = T è®¡ç®—ç»Ÿè®¡å€¼
    
    # Descriptive stats via describe (psych) 
    install.packages("psych")
    library(psych)
    describe(mtcars{myvars}, trim = 0.1)
    # trim = 0.1 å»é™¤æœ€ä½10%å’Œæœ€é«˜10%çš„æ•°æ®
    Hmisc::describe(mtcars)
    # å‡½æ•°é¡ºåºï¼šåå…¥ä¸ºä¸»ï¼ˆåé¢è½½å…¥çš„åŒ…å‡½æ•°ä¼šè¦†ç›–å‰é¢çš„åŒ…å‡½æ•°ï¼‰
    # ç”¨::æ¥è¡¨æ˜å‡½æ•°æ¥æº
    
    # Descriptive stats by group with aggregate
    library(MASS)
    aggregate() # æ¯æ¬¡åªèƒ½ç”¨ä¸€ä¸ªç»Ÿè®¡å‡½æ•°
    
    # Descriptive stats by group via summaryBy
    install.packages("doBy")
    library(doBy)
    summaryBy(mpg+hp+wt ~ am, data=mtcars, FUN=mystats)
    
    # Descriptive stats by group via describe.by (psych)
    library(psych)
    describeBy(mtcars[myvars], list(am=mtcars$am)) # æ²¡åŠæ³•ä½¿ç”¨è‡ªå®šä¹‰çš„å‡½æ•°
    
    
    
# P45     é¢‘æ•°ç»Ÿè®¡å‡½æ•°----------------------------------------------------------
    
    # frequency table
    split(mtcars, as.factor(mtcars$cyl)) # ä»¥cylçš„å› å­åˆ†ç±»
    cut(mtcars$mpg, c(seq(10, 50, 10))) # æœ€åä¸€ä¸ªæ•°ä¸ºé—´éš”æ•°ï¼ˆ10-20ï¼Œ20-30ï¼Œ30-40ï¼Œ40-50ï¼‰
    table(mtcars$cyl) # é¢‘æ•°çš„ç»Ÿè®¡
    prop.table(table(mtcars$cyl)) # è®¡ç®—æ¯ç§å› å­çš„æ¯”ä¾‹
    
    # äºŒç»´
    library(vcd)
    table(Arthritis$Treatment, Arthritis$Improved)
    with(data=Arthritis, table(Treatment, Improved))
    x <- xtabs(~ Treatment + Improved, data = Arthritis)
    margin.table(x, 1)
    prop.table(x, 1)
    # 1 = åªæ·»åŠ è¡Œ
    # 2 = åªæ·»åŠ åˆ—
    
    # ä¸‰ç»´
    y <- xtabs(~ Treatment + Improved + Sex, data = Arthritis)
    ftable(y) # å¹³é“ºå¼çš„åˆ—è”è¡¨
    
    
    
# P46     ç‹¬ç«‹æ€§æ£€éªŒå‡½æ•°--------------------------------------------------------
    
    # æ ¹æ®é¢‘æ•°ä¿¡æ¯ï¼Œåˆ¤æ–­ä¸¤ç±»å› å­ï¼Œå½¼æ­¤ç›¸å…³æˆ–ç›¸äº’ç‹¬ç«‹çš„å‡è®¾æ£€éªŒ
    # ç‹¬ç«‹æ€§ï¼šå˜é‡ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å…³ç³»
    
    # p-value (probability)ï¼šåœ¨åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œå¾—åˆ°æœ€å¤§çš„æˆ–è€…è¶…å‡ºæ‰€å¾—åˆ°çš„æ£€éªŒç»Ÿè®¡é‡å€¼çš„æ¦‚ç‡ã€‚
    # åŸå‡è®¾ï¼šæ²¡æœ‰å‘ç”Ÿ / å¤‡æ‹©å‡è®¾ï¼šå‘ç”Ÿäº†
    # ä¸€èˆ¬å°†på€¼å®šä½åˆ°0.05ï¼Œå½“p<0.05æ‹’ç»åŸå‡è®¾ï¼ˆä¸é è°±ï¼‰ï¼Œå½“p>0.05ä¸æ‹’ç»åŸå‡è®¾ï¼ˆé è°±ï¼‰ã€‚
    # på€¼è®¾å®šçš„è¶Šå°ï¼Œè¶Šç²¾ç¡®ã€‚
    
    # å¡æ–¹æ£€éªŒï¼ˆChi-square testï¼‰
    library(vcd)
    mytable <- table(Arthritis$Treatment, Arthritis$Improved) # å˜é‡çš„é¡ºåºä¸é‡è¦
    chisq.test(mytable)
    
    # Fisher's exact test
    mytable <- xtabs(~Treatment+Improved, data=Arthritis) 
    fisher.test(mytable)
    
    # Cochran-Mantel-Haenszelæ£€éªŒ
    mytable <- xtabs(~Treatment+Improved+Sex, data=Arthritis) # å˜é‡çš„é¡ºåºå¾ˆé‡è¦ï¼ˆå› ä¸ºè¦ä¸‰ä¸ªå˜é‡ï¼‰
    mantelhaen.test(mytable)
    
    
# P47     ç›¸å…³æ€§åˆ†æå‡½æ•°--------------------------------------------------------
    
    # ç›¸å…³æ€§åˆ†æï¼šå¯¹ä¸¤ä¸ªæˆ–å¤šä¸ªå…·å¤‡ç›¸å…³æ€§çš„å˜é‡å…ƒç´ è¿›è¡Œåˆ†æï¼Œä»è€Œè¡¡é‡ä¸¤ä¸ªå˜é‡å› ç´ çš„ç›¸å…³å¯†åˆ‡ç¨‹åº¦ã€‚
    # ç›¸å…³æ€§çš„å…ƒç´ ä¹‹é—´éœ€è¦å­˜åœ¨ä¸€å®šçš„è”ç³»æˆ–è€…æ¦‚ç‡æ‰å¯ä»¥è¿›è¡Œç›¸å…³æ€§åˆ†æï¼ˆå˜é‡ä¹‹é—´æ˜¯å¦æœ‰å…³ç³»ï¼‰
    
    # æ­£ç›¸å…³æˆ–è´Ÿç›¸å…³ï¼ˆç›¸å…³ç³»æ•°ï¼‰
      # Pearsonç›¸å…³ç³»æ•°
      # Spearmanç›¸å…³ç³»æ•°
      # Kendallç›¸å…³ç³»æ•°
      # åç›¸å…³ç³»æ•°
      # å¤šåˆ†æ ¼ï¼ˆpolychoricï¼‰ç›¸å…³ç³»æ•°
      # å¤šç³»åˆ—ï¼ˆpolyserialï¼‰ç›¸å…³ç³»æ•°
    
    # ä½¿ç”¨cor()è®¡ç®—ç›¸å…³ç³»æ•°
    cor(state,x77) # é»˜è®¤method="pearson"
    cor(state.x77, method="spearman")
    # æ­£è´Ÿå·è¡¨ç¤ºæ­£ç›¸å…³æˆ–è´Ÿç›¸å…³
    
    cov(state.x77) # åæ–¹å·®
    
    x <- state.x77[, c(1,2,3,6)]
    y <- state.x77[, c(4,5)]
    cor(x, y)
    
    # partial correlations åç›¸å…³ç³»æ•°
    install.packages("ggm")
    library(ggm)
    # partial correlation of population(1) and murder rate(5), controlling 
    # for income(2), illiteracy rate(3), and HS graduation rate(6)
    colnames(state.x77)
    pcor(c(1,5,2,3,6), cov(state.x77))
    
    
# P48     ç›¸å…³æ€§æ£€éªŒå‡½æ•°--------------------------------------------------------
    
    # Testing a correlation coefficient for significance
    cor.test(state.x77[,3], state.x77[,5])
    
    # Confidence intervalï¼ˆç½®ä¿¡åŒºé—´ï¼‰
    # æ ·æœ¬ç»Ÿè®¡é‡æ‰€æ„é€ çš„æ€»ä½“å‚æ•°çš„ä¼°è®¡åŒºé—´ï¼ˆè¢«æµ‹é‡å‚æ•°çš„æµ‹é‡å€¼çš„å¯ä¿¡ç¨‹åº¦ï¼‰
    # æ¦‚ç‡å‘ç”Ÿçš„èŒƒå›´
    
    # Correlation matrix and tests of significance via corr.test
    corr.test(states, use="complete")
    library(psych)
    corr.test(state.x77)
    library(ggm)
    x <- pcor(c(1,5,2,3,6), cov(state.x77))
    pcor.test(x, 3, 50) # 3 -> å˜é‡æ•°ï¼Œ50 -> æ ·æœ¬æ•°
    
    # Two Sample  t-test
    library(MASS)
    t.test(Prob ~ So, data=UScrime)
    t.test(y ~ x, data = )
    
    # éå‚æ•°æ£€éªŒï¼ˆNonparametric testï¼‰ï¼šåœ¨æ€»ä½“æ–¹å·®æœªçŸ¥æˆ–çŸ¥é“ç”šå°‘çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨æ ·æœ¬å¯¹æ€»ä½“åˆ†å¸ƒå½¢æ€ç­‰è¿›è¡Œæ¨æ–­çš„æ–¹æ³•ã€‚
    # å‚æ•°æ£€éªŒï¼ˆParametric testï¼‰:æ€»ä½“åˆ†å¸ƒå½¢å¼å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œå¯¹æ€»ä½“åˆ†å¸ƒçš„å‚æ•°ï¼ˆå¦‚å‡å€¼ã€æ–¹å·®ç­‰ï¼‰è¿›è¡Œæ¨æ–­çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯æ•°æ®åˆ†å¸ƒå·²çŸ¥ï¼Œæ¯”å¦‚æ»¡è¶³æ­£æ€åˆ†å¸ƒã€‚
    
    # dependent t test
    sapply(UScrime[c("U1", "U2")], function(x)(c(mean=mean(x), sd=sd(x))))
    with(UScrime, t.test(U1, U2, paired=T))
    
    
    
# P49     ç»˜å›¾å‡½æ•°--------------------------------------------------------------
    
    # 1. RåŸºç¡€ç»˜å›¾ç³»ç»Ÿ
    ls("package:graphics")
    demo(graphics)
    help(package=graphics)
      # ï¼ˆ1ï¼‰é«˜çº§ç»˜å›¾ï¼šä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥ç»˜åˆ¶å‡ºå›¾
      # ï¼ˆ2ï¼‰ä½çº§ç»˜å›¾ï¼šä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¾—åœ¨é«˜çº§ç»˜å›¾äº§ç”Ÿå›¾å½¢çš„åŸºç¡€ä¸Šï¼Œå¯¹å›¾å½¢è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚åŠ çº¿ã€æ ‡é¢˜æ–‡å­—ç­‰
      # çŸ¥é“è¾“å…¥æ•°æ®çš„æ ¼å¼å¾ˆé‡è¦ï¼š
          # æ•£ç‚¹å›¾ï¼šxå’Œyä¸¤ä¸ªåæ ‡æ•°æ®
          # ç›´æ–¹å›¾ğŸ“Šï¼šå› å­
          # çƒ­åŠ›å›¾ï¼šæ•°æ®çŸ©é˜µ
    plot(women$height)
    plot(women$height, women$weight)
    plot(as.factor(women$height))
    
    plot(as.factor(mtcars$cyl)) # ç›´æ–¹å›¾
    plot(as.factor(mtcars$cyl), mtcars$carb) # ç®±çº¿å›¾
    plot(mtcars$carb, as.factor(mtcars$cyl)) # æ•£åˆ—å›¾
    plot(as.factor(mtcars$cyl), as.factor(mtcars$carb)) # è„ŠæŸ±å›¾
    
    plot(women$height ~ women$weight) # å¦ä¸€ç§å†™æ³•
    
    fit <-lm(height ~ weight, data=women)
    plot(fit) # plotä¼šè‡ªåŠ¨æ£€æµ‹è¾“å…¥çš„æ•°æ®ç±»å‹æ¥è¿›è¡Œä¸åŒçš„ç»˜å›¾
    method(plot)
    method(summary)
      
      # S3ç³»ç»Ÿï¼šå±æ€§ï¼Œæ³›å‹å‡½æ•°ï¼Œæ–¹æ³•
    
    ?par # parameterï¼ˆç”¨äºå¾®è°ƒï¼‰
    par() # Rç»˜å›¾çš„é»˜è®¤è®¾ç½®
    plot(as.factor(mtcars$cyl), col=c("red", "green", "blue")) # colä¸ºå…¶ä¸­ä¸€é¡¹å‚æ•°
    
    # 2. latticeåŒ…
    
    # 3. ggplot2åŒ…
    
    # 4. gridåŒ…
    
    
    
# P50     è‡ªå®šä¹‰å‡½æ•°------------------------------------------------------------
    
    # è‡ªå·±ç¼–å†™å‡½æ•°
    # è¾“å…¥ä¸åŠ æ‹¬å·çš„å‡½æ•°ï¼Œè¾“å‡ºæºä»£ç 
    
    # 1. å‡½æ•°åç§°
        # 1.1 å‡½æ•°å‘½ä»¤ä¸åŠŸèƒ½ç›¸å…³
        # 1.2 å¯ä»¥æ˜¯å­—æ¯ä¸æ•°å­—çš„ç»“åˆï¼Œä½†å¿…é¡»æ˜¯å­—æ¯å¼€å¤´
    # 2. å‡½æ•°å£°æ˜
    # 3. å‡½æ•°å‚æ•°
    # 4. å‡½æ•°ä½“
    
    myfun <- function(é€‰é¡¹å‚æ•°)
        {
          å‡½æ•°ä½“
                  }
    
    # ä¾‹å­ï¼šè®¡ç®—ååº¦å’Œå³°åº¦çš„å‡½æ•°
    # ååº¦ï¼ˆskewnessï¼‰ï¼šç»Ÿè®¡æ•°æ®åˆ†å¸ƒåæ–œæ–¹å‘å’Œç¨‹åº¦çš„åº¦é‡ï¼Œæ˜¯ç»Ÿè®¡æ•°æ®åˆ†å¸ƒéå¯¹ç§°ç¨‹åº¦çš„æ•°å­—ç‰¹å¾ã€‚
    # å³°åº¦ï¼ˆpeakednessï¼›kurtosisï¼‰ï¼šå³°æ€ç³»æ•°ã€‚è¡¨å¾æ¦‚ç‡å¯†åº¦åˆ†å¸ƒæ›²çº¿åœ¨å¹³å‡å€¼å¤„å³°å€¼é«˜ä½çš„ç‰¹å¾æ•°ã€‚
    mystats <- function(x, na.omit=FALSE) {
      if(na.omit)
        x <- x[!is.na(x)] # xåªå–ä¸åŒ…å«NAçš„å€¼
      m <- mean(x)
      n <- length(x)
      s <- sd(x)
      skew <- sum((x-m)^3 / s^3) / n
      kurt <- sum((x-m)^4 / s^4) / n-3
      return(c(n=n, mean=m, stdev=s, skewness=skew, kurtosis=kurt))
    }
    
    # å¾ªç¯ä¸å‘é‡åŒ–æ“ä½œï¼šå‡½æ•°å†…éƒ¨é€šè¿‡å¾ªç¯å®ç°å‘é‡åŒ–æ“ä½œ
        # ifæ¡ä»¶åˆ¤æ–­
    score=70;if (score > 60) {print("Passed")} else {print("Failed")}
    ifelse(score > 60, "Passed", "Failed") # ä¸¤ç§å†™æ³•ï¼ˆifelseè‡ªå¸¦è¾“å‡ºåŠŸèƒ½ï¼‰
        # forå¾ªç¯
    for (i in 1:10) {print("Hello")}
        # whileå¾ªç¯
    i=1;while(i <= 10) {print("Hello");i=i+1;}
        # switchè¯­å¥ç­‰
    
    # å¾ªç¯ä¸‰éƒ¨åˆ†
        # 1. æ¡ä»¶åˆ¤æ–­ï¼ŒçœŸæˆ–å‡
        # 2. ç”¨äºå¾ªç¯æ‰§è¡Œçš„ç»“æ„
        # 3. è¡¨è¾¾å¼
    
    
# P51     æ•°æ®åˆ†æå®æˆ˜----------------------------------------------------------
    
    # å°éº¦äº§é‡æ¡ˆä¾‹
    # æˆ¿åœ°äº§æ¡ˆä¾‹
    # æ€§ä»·æ¯”æ¡ˆä¾‹
    # è¯ç‰©è¯•éªŒæ¡ˆä¾‹
    # ç¤¾ä¼šç§‘å­¦ç ”ç©¶æ¡ˆä¾‹
    # é‡åŒ–æŠ•èµ„æ¡ˆä¾‹ï¼ˆè®¡é‡ç»æµå­¦ï¼‰
    
    # åé¢æ¡ˆä¾‹
    # è‹¹æœçš„Think differentï¼Ÿï¼Ÿï¼Ÿ
    
    
# P52-53  çº¿æ€§å›å½’ï¼ˆregressionï¼‰------------------------------------------------
    
    # å›å½’ï¼šæŒ‡é‚£äº›ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªé¢„æµ‹å˜é‡ï¼ˆè‡ªå˜é‡ã€è§£é‡Šå˜é‡ï¼‰ï¼Œæ¥é¢„æµ‹å“åº”å˜é‡ï¼ˆå› å˜é‡ã€æ•ˆæ ‡å˜é‡ã€ç»“æœå˜é‡ï¼‰çš„æ–¹æ³•ã€‚
    # æ ¹æ®ä¸€å¤§å †æ•°æ®ï¼Œæ‰¾åˆ°å®ƒä»¬çš„è§„å¾‹ã€‚
    
    # å¦‚ä½•å»ºç«‹æ¨¡å‹ã€‚æŠ½è±¡å‡ºæ•°å­¦å…¬å¼ï¼Œå“ªäº›å› ç´ ä¸æ¨¡å‹æœ‰å…³ï¼Œéœ€è¦åˆ©ç”¨å¤šå°‘æ ·å“ï¼Œæ¨¡å‹çš„å‡†ç¡®ç‡æœ‰å¤šé«˜ï¼Œåœ¨å®é™…è¿ç”¨ä¸­è¿˜æ˜¯å¦æœ‰æ•ˆã€‚
    
    # çº¿æ€§å›å½’ æˆ– éçº¿æ€§å›å½’
    
    # æ™®é€šæœ€å°äºŒä¹˜å›å½’æ³•ï¼ˆOLSï¼‰
    
    plot(women$height, women$weight)
    fit <- lm(formula = weight ~ height, data = women) # çº¿æ€§å›å½’åˆ†æï¼ˆæ‹Ÿåˆï¼‰
    summary(fit) 
    # æ®‹å·®ï¼ˆresidualsï¼‰è¶Šå°ï¼Œè¶Šæ¥è¿‘çº¿æ€§å…³ç³»
    # R-squared è¡¨ç¤ºç¬¦åˆæ¨¡å‹çš„æ•°æ®å æ¯”
    # ä¸€èˆ¬å…ˆçœ‹p-valueæ˜¯å¦<0.05ï¼Œå¦‚æœä¸å°äºä¸€èˆ¬è¯´æ˜æ¨¡å‹ä¸ç¬¦åˆ
    # å†çœ‹R-squaredï¼Œæœ‰å¤šå°‘æ•°æ®ç¬¦åˆæ¨¡å‹
    
    "~" #åˆ†å‰²ç¬¦å·
    # å·¦è¾¹ä¸ºå“åº”å˜é‡ï¼ˆyï¼‰ï¼Œå³è¾¹æ˜¯è§£é‡Šå˜é‡ï¼ˆxï¼‰
    
    "+" # åˆ†éš”é¢„æµ‹/è§£é‡Šå˜é‡
    
    ":" # è¡¨ç¤ºé¢„æµ‹å˜é‡çš„äº¤äº’é¡¹
    # æ¯”å¦‚ï¼Œè¦é€šè¿‡xã€zåŠxä¸zçš„äº¤äº’é¡¹æ¥é¢„æµ‹yï¼Œä»£ç ä¸ºy ~ x + z + x:z
    
    "*" # è¡¨ç¤ºæ‰€æœ‰å¯èƒ½äº¤äº’é¡¹çš„ç®€æ´æ–¹å¼
    # ä»£ç  y ~ x * z * w å¯å±•å¼€ä¸º y ~ x + z + w + x:z + x:w + z:w + x:z:w
    
    "^" # è¡¨ç¤ºäº¤äº’é¡¹è¾¾åˆ°æŸä¸ªæ¬¡æ•°
    # ä»£ç  y ~ (x + z + w)^2 å¯å±•å¼€ä¸º y ~ x + z + w + x:z + x:w + z:w
    
    "." # è¡¨ç¤ºåŒ…å«é™¤å› å˜é‡å¤–çš„æ‰€æœ‰å˜é‡
    # æ¯”å¦‚ï¼Œè‹¥ä¸€ä¸ªæ•°æ®æ¡†åŒ…å«å˜é‡xã€yã€zå’Œwï¼Œä»£ç  y ~. å¯å±•å¼€ä¸º y ~ x + z + w
    
    "-" # å‡å·ï¼Œè¡¨ç¤ºä»ç­‰å¼ä¸­ç§»é™¤æŸä¸ªå˜é‡
    # ä»£ç  y ~ (x + z + w)^2 - x:w å¯å±•å¼€ä¸º y ~ x + z + w + x:z + z:w
    
    "-1" # åˆ é™¤æˆªè·é¡¹
    # æ¯”å¦‚ï¼Œè¡¨è¾¾å¼ y ~ x - 1 æ‹Ÿåˆyåœ¨xä¸Šçš„å›å½’ï¼Œå¹¶å¼ºåˆ¶ç›´çº¿é€šè¿‡åŸç‚¹
    
    I() # ä»ç®—æœ¯çš„è§’åº¦æ¥è§£é‡Šæ‹¬å·ä¸­çš„å…ƒç´ 
    # æ¯”å¦‚ï¼Œy~x+(z+w)^2 å±•å¼€ä¸º y~x+z+w+z:w
    # ä»£ç  y~x+ I((z+w)^2) å±•å¼€ä¸º y~x+h ï¼ˆhæ˜¯ä¸€ä¸ªç”±zå’Œwçš„å¹³æ–¹å’Œåˆ›å»ºçš„æ–°å˜é‡ï¼‰
    
    "function()" # å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ç”¨çš„æ•°å­¦å‡½æ•°
    # æ¯”å¦‚ï¼Œlog(y) ~ x + z + w è¡¨ç¤ºé€šè¿‡xã€zå’Œwæ¥é¢„æµ‹log(y)
    
    # çº¿æ€§æ‹Ÿåˆå¸¸ç”¨å‡½æ•°
    summary() # å±•ç¤ºæ‹Ÿåˆæ¨¡å‹çš„è¯¦ç»†ç»“æœ
    coefficients() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„æ¨¡å‹å‚æ•°ï¼ˆy-interceptå’Œslopeï¼‰
    confint(data, level = 0.5) # æä¾›æ¨¡å‹å‚æ•°çš„confidence intervalï¼ˆé»˜è®¤95%ï¼Œç”¨levelå‚æ•°è°ƒæ•´ï¼‰
    fitted() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„é¢„æµ‹å€¼
    residuals() # åˆ—å‡ºæ‹Ÿåˆæ¨¡å‹çš„æ®‹å·®å€¼ï¼ˆæ®‹å·®ï¼ˆresidualsï¼‰è¶Šå°ï¼Œè¶Šæ¥è¿‘çº¿æ€§å…³ç³»ï¼‰
    anova() # ç”Ÿæˆä¸€ä¸ªæ‹Ÿåˆæ¨¡å‹çš„æ–¹å·®åˆ†æè¡¨ï¼Œæˆ–è€…æ¯”è¾ƒä¸¤ä¸ªæˆ–å¤šä¸ªæ‹Ÿåˆæ¨¡å‹çš„æ–¹å·®åˆ†æè¡¨
    vcov() # åˆ—å‡ºæ¨¡å‹å‚æ•°çš„åæ–¹å·®çŸ©é˜µ
    AIC() # è¾“å‡ºèµ¤æ± ä¿¡æ¯ç»Ÿè®¡é‡
    plot() # ç”Ÿæˆè¯„ä»·æ‹Ÿåˆæ¨¡å‹çš„è¯Šæ–­å›¾
    predict(model, new.data) # ç”¨æ‹Ÿåˆæ¨¡å‹å¯¹æ–°çš„æ•°æ®é›†é¢„æµ‹å“åº”å˜é‡å€¼
    abline() # ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿
    
    # å¤šé¡¹å¼
    fit2 <- lm(weight ~ height + I(height^2), data = women)
    summary(fit2)
    lines(women$height, fitted(fit2), col="red")
    lines(x, y) # æ¨ªåæ ‡ï¼ˆxï¼‰ï¼Œçºµåæ ‡ï¼ˆyï¼‰ï¼ˆè¿™é‡Œçºµåæ ‡ç”¨äº†é¢„æµ‹å€¼ï¼‰
    #ä¸‰æ¬¡é¡¹
    fit3 <- lm(weight ~ height + I(height^2) + I(height^3), data = women)
    summary(fit3)
    lines(women$height, fitted(fit3), col="blue")
    
    # ä¸èƒ½æ‹Ÿåˆä¸è¶³ï¼Œä¹Ÿä¸èƒ½æ‹Ÿåˆè¿‡åº¦
    
    
    
# P54     å¤šå…ƒçº¿æ€§å›å½’----------------------------------------------------------
    
    # å¤šä¸ªå˜é‡ï¼Œæƒé‡ä¹Ÿä¸åŒ
    
    states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
    fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
    summary(fit)
    coef(fit)
    qqplot(fit, labels = row.names(states), id.method = "identify", simulate = T, main = "Q-Q Plot")
    
    fit2 <- lm(mpg ~ hp + wt + hp:wt, data = mtcars)
    summary(fit2)
    
    # å¦‚ä½•ä»ä¼—å¤šæ¨¡å‹ä¸­ï¼Œé€‰æ‹©æœ€ä½³æ¨¡å‹
    # æ¯”è¾ƒæ¨¡å‹,AICå€¼è¶Šå°è¶Šå¥½
    m1 <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
    m2 <- lm(Murder ~ Population + Illiteracy, data = states)
    AIC(m1, m2)
    
    # é€æ­¥å›å½’æ³•ï¼ˆBackward stepwise selectionï¼‰
    library(MASS)
    states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
    fit <- lm(Murder ~ Population + Illiteracy + Income + Frost, data = states)
    stepAIC(fit, direction = "backward")
    
    # å…¨å­é›†å›å½’æ³•ï¼ˆAll subsets regressionï¼‰
    library(leaps)
    states <- as.data.frame(state.x77, c("Murder", "Population", "Illiteracy", "Income", "Frost"))
    leaps <- regsubsets(Murder ~ Population + Illiteracy + Income + Frost, data = states, nbest = 4)
    plot(leaps, scale = "adjr2")
    
    
# P55     å›å½’è¯Šæ–­--------------------------------------------------------------
    
    fit <-  lm(weight ~ height, data=women)
    opar <- par(no.readonly = T)
    par(mfrow=c(2,2)) # è¡¨ç¤ºæ¨ªæ’ç«–æ’å„æ˜¾ç¤ºä¸¤å¹…
    plot(fit)
    par(opar)
    
    # æ»¡è¶³OLSæ¨¡å‹ç»Ÿè®¡å‡è®¾
    # 1. æ­£æ€æ€§ï¼šå¯¹äºå›ºå®šçš„è‡ªå˜é‡å€¼ï¼Œå› å˜é‡å€¼æˆæ­£æ€åˆ†å¸ƒ
    # 2. ç‹¬ç«‹æ€§ï¼šå› å˜é‡ä¹‹é—´äº’ç›¸ç‹¬ç«‹
    # 3. çº¿æ€§ï¼šå› å˜é‡ä¸è‡ªå˜é‡ä¹‹é—´ä¸ºçº¿æ€§å…³ç³»
    # 4. åŒæ–¹å·®æ€§ï¼šå› å˜é‡çš„æ–¹å·®ä¸éšè‡ªå˜é‡çš„æ°´å¹³ä¸åŒè€Œå˜åŒ–ã€‚ä¹Ÿå¯ç§°ä½œä¸å˜æ–¹å·®ã€‚
    
    fit2 <- lm(weight ~ height + I(height^2), data = women)
    opar <- par(no.readonly = T)
    par(mfrow=c(2,2))
    plot(fit2)
    par(opar)
    
    # æŠ½æ ·æ³•éªŒè¯
    # 1. æ•°æ®ä¸­æœ‰1000ä¸ªæ ·æœ¬ï¼ŒéšæœºæŠ½å–500ä¸ªæ•°æ®è¿›è¡Œå›å½’åˆ†æ
    # 2. æ¨¡å‹å»ºå¥½åï¼Œåˆ©ç”¨predict()ï¼Œå¯¹å‰©ä¸‹çš„500ä¸ªæ ·æœ¬è¿›è¡Œé¢„æµ‹ï¼Œæ¯”è¾ƒæ®‹å·®å€¼
    # 3. å¦‚æœé¢„æµ‹å‡†ç¡®ï¼Œè¯´æ˜æ¨¡å‹å¯ä»¥ï¼Œå¦åˆ™å°±éœ€è¦è°ƒæ•´æ¨¡å‹
  
    
    
# P56-57  æ–¹å·®åˆ†æï¼ˆAnalysis of Varianceï¼‰--------------------------------------------------------------
    
    # æ–¹å·®åˆ†æï¼ˆAnalysis of Variance / ANOVAï¼‰ï¼Œä¹Ÿç§°å˜å¼‚æ•°åˆ†æ
    # ç”¨äºä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šæ ·æœ¬å‡æ•°å·®åˆ«çš„æ˜¾è‘—æ€§æ£€éªŒã€‚
    # ä»å¹¿ä¹‰ä¸Šæ¥è®²ï¼Œæ–¹å·®åˆ†æå±äºå›å½’åˆ†æçš„ä¸€ç§ã€‚ä½†çº¿æ€§å›å½’çš„å› å˜é‡ä¸€èˆ¬æ˜¯è¿ç»­å‹å˜é‡ã€‚è€Œå½“è‡ªå˜é‡æ˜¯å› å­æ—¶ï¼Œç ”ç©¶å…³æ³¨çš„é‡ç‚¹é€šå¸¸ä¼šä»é¢„æµ‹è½¬å‘ä¸åŒç»„ä¹‹é—´å·®å¼‚çš„æ¯”è¾ƒã€‚
    
    # 1. å•å› ç´ æ–¹å·®åˆ†æANOVAï¼ˆç»„å†…ï¼Œç»„é—´ï¼‰
    y ~ A
        # æ¡ˆä¾‹
        library(multcomp)
        attach(cholesterol)
        table(trt)
        aggregate(response, by=list(trt), FUN=mean)
        fit <- aov(response ~ trt, data = cholesterol)
        summary(fit)
        plot(fit)
        fit.lm <- lm(response ~ trt, data = cholesterol)
        summary(fit.lm)
        
    # 2. åŒå› ç´ æ–¹å·®åˆ†æANOVA
    y ~ A * B
        # æ¡ˆä¾‹
        attach(ToothGrowth)
        xtabs(~ supp+dose)
        aggregate(len, by=list(supp, dose), FUN=mean)
        aggregate(len, by=list(supp, dose), FUN=sd)
        ToothGrowth$dose <- factor(ToothGrowth$dose)
        fit <- aov(len ~ supp*dose, data=ToothGrowth)
        summary(fit)
        install.packages("HH")        
        interaction.plot(dose, supp, len, type = "b", col = c("red", "blue"), 
                         pch = c(16,18), 
                         main = "Interaction between Dose and Supplement Type")
        
    # 3. åæ–¹å·®åˆ†æANCOVA
    y ~ x + A
    y ~ x1 + x2 + A*B
        # å•å› ç´ åæ–¹å·®æ¡ˆä¾‹
        table(litter$dose)
        attach(litter)
        aggregate(weight, by=list(dose), FUN=mean)
        fit <- aov(weight ~ gesttime+dose, data=litter) # gesttimeä¸ºåå˜é‡
        summary(fit)
        
    # 4. å¤šå…ƒæ–¹å·®åˆ†æMANOVA
        # æ¡ˆä¾‹
        library(MASS)
        attach(UScereal)
        shelf <- factor(shelf)
        aggregate(cbind(calories, fat, sugars), by=list(shelf), FUN=mean)
        fit <- manova(cbind(calories, fat, sugars) ~ shelf, data=UScereal)
        summary(fit)
        summary.aov(fit)
        
    # 5. å¤šå…ƒåæ–¹å·®åˆ†æMANCOVA
    
    ?aov
    
    # é¡ºåºå¾ˆé‡è¦
    y ~ A + B + A:B
    # åœ¨Rä¸­ï¼Œé¡ºåºä¸ºåºè´¯å‹ã€‚æ•ˆåº”æ ¹æ®è¡¨è¾¾å¼ä¸­å…ˆå‡ºç°çš„æ•ˆåº”åšè°ƒæ•´ã€‚
    # Aä¸åšè°ƒæ•´ï¼ŒBæ ¹æ®Aåšè°ƒæ•´ï¼ŒA:Bäº¤äº’é¡¹æ ¹æ®Aå’ŒBè°ƒæ•´ã€‚
    
    
    
# P58     åŠŸæ•ˆåˆ†æï¼ˆPower Analysisï¼‰--------------------------------------------
    
    # åŠŸæ•ˆåˆ†æï¼Œå¯ä»¥å¸®åŠ©åœ¨ç»™å®šç½®ä¿¡åº¦çš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­æ£€æµ‹åˆ°ç»™å®šæ•ˆåº”å€¼æ—¶æ‰€éœ€çš„æ ·æœ¬é‡ã€‚
    # åè¿‡æ¥ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨ç»™å®šç½®ä¿¡åº¦æ°´å¹³æƒ…å†µä¸‹ï¼Œè®¡ç®—åœ¨æŸæ ·æœ¬é‡å†…èƒ½æ£€æµ‹åˆ°ç»™å®šæ•ˆåº”å€¼çš„æ¦‚ç‡ã€‚
    
    # åŠŸæ•ˆåˆ†æå‡½æ•°ï¼ˆpwråŒ…ä¸­çš„å‡½æ•°ï¼‰
    install.packages("pwr")
    pwr.2p.test() # ä¸¤æ¯”ä¾‹ï¼ˆnç›¸ç­‰ï¼‰
    pwr.2p2n.test() # ä¸¤æ¯”ä¾‹ï¼ˆnä¸ç›¸ç­‰ï¼‰
    pwr.anova.test() # å¹³è¡¡çš„å•å› ç´ ANOVA
        pwr.anova.test(k=2, f=25, sig.level=0.05, power=0.90)
    pwr.chisq.test() # å¡æ–¹æ£€éªŒ
    pwr.f2.test() # å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆLinear Modelsï¼‰
        pwr.f2.test(u=3, f2=0.0769, sig.level=0.05, power=0.90)
    pwr.p.test() # æ¯”ä¾‹ï¼ˆå•æ ·æœ¬ï¼‰
    pwr.r.test() # ç›¸å…³ç³»æ•°
    pwr.t.test() # tæ£€éªŒï¼ˆå•æ ·æœ¬ã€ä¸¤æ ·æœ¬ã€é…å¯¹ï¼‰
        pwr.t.test(d=.8, sig.level=.05, power=.9, type="two.sample", alternative="two.sided")
        pwr.t.test(n=20, d=.5, sig.level=.01, type="two.sample", alternative="two.sided")
    pwr.t2n.test() # tæ£€éªŒï¼ˆnä¸ç›¸ç­‰çš„ä¸¤æ ·æœ¬ï¼‰
    
    # åŠŸæ•ˆåˆ†æç†è®ºåŸºç¡€
    # 1. æ ·æœ¬å¤§å°ï¼šå®éªŒè®¾è®¡ä¸­æ¯ç§æ¡ä»¶/ç»„ä¸­è§‚æµ‹çš„æ•°ç›®ã€‚
    # 2. æ˜¾è‘—æ€§æ°´å¹³ï¼ˆalphaï¼‰ï¼šç”±Iå‹é”™è¯¯çš„æ¦‚ç‡æ¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å‘ç°æ•ˆåº”ä¸å‘ç”Ÿçš„æ¦‚ç‡ã€‚
    # 3. åŠŸæ•ˆï¼šé€šè¿‡Iå‡å»IIå‹é”™è¯¯çš„æ¦‚ç‡æ¥å®šä¹‰ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯çœŸå®æ•ˆåº”å‘ç”Ÿçš„æ¦‚ç‡ã€‚
    # 4. æ•ˆåº”å€¼ï¼šæŒ‡çš„æ˜¯åœ¨å¤‡æ‹©æˆ–ç ”ç©¶å‡è®¾ä¸‹æ•ˆåº”çš„é‡ã€‚æ•ˆåº”å€¼çš„è¡¨è¾¾å¼ä¾èµ–äºå‡è®¾æ£€éªŒä¸­ä½¿ç”¨çš„ç»Ÿè®¡æ–¹æ³•ã€‚
    # æœ‰å…¶ä¸­ä¸‰ä¸ªï¼Œå°±å¯ä»¥æ±‚å‡ºç¬¬å››ä¸ªæ•°
    
    
# P59     å¹¿ä¹‰çº¿æ€§æ¨¡å‹----------------------------------------------------------
    
    # å¹¿ä¹‰çº¿æ€§æ¨¡å‹æ‰©å±•äº†çº¿æ€§æ¨¡å‹çš„æ¡†æ¶ï¼Œå®ƒåŒ…å«äº†éæ­£æ€å› å˜é‡çš„åˆ†æã€‚
    
    ?glm # Generalized Linear Models
    data(breslow.dat, package="robust") # åŠ è½½æ•°æ®é›†
    names(breslow.dat)
    summary(breslow.dat[c(6,7,8,10)]) # ç»Ÿè®¡æ•°æ®é›†
    
    # æ³Šæ¾å›å½’ï¼ˆPoisson regressionï¼‰
    # ç”¨æ¥ä¸ºè®¡æ•°èµ„æ–™å’Œåˆ—è”è¡¨å»ºæ¨¡çš„ä¸€ç§å›å½’åˆ†æã€‚
    # å‡è®¾å› å˜é‡æ˜¯æ³Šæ¾åˆ†å¸ƒï¼Œå¹¶å‡è®¾å®ƒå¹³å‡å€¼çš„å¯¹æ•°å¯è¢«æœªçŸ¥å‚æ•°çš„çº¿æ€§ç»„åˆå»ºæ¨¡ã€‚
    
    attach(breslow.dat)
    # fit regression
    fit <- glm(sumY ~ Base + Age + Trt, data = breslow.dat, family = poisson(link="log"))
    summary(fit)
    
    # intercept model parameter
    coef(fit)
    exp(coef(fit))
    
    
    
# P60     Logisticå›å½’----------------------------------------------------------
    
    # é€šè¿‡ä¸€ç³»åˆ—è¿ç»­å‹æˆ–ç±»åˆ«å‹é¢„æµ‹å˜é‡ï¼Œæ¥é¢„æµ‹äºŒå€¼å‹ç»“æœå˜é‡æ—¶ï¼ŒLogisticså›å½’å¾ˆæœ‰ç”¨ã€‚
    
    data(Affairs, package="AER")
    summary(Affairs)
    table(Affairs$affairs)
    prop.table(table(Affairs$affairs))
    prop.table(table(Affairs$gender))
    
    # create binary outcome variable
    Affairs$ynaffairs[Affairs$affairs > 0] <- 1
    Affairs$ynaffairs[Affairs$affairs == 0] <- 0
    Affairs$ynaffairs <- factor(Affairs$ynaffair, levels = c(0,1), labels = c("No", "Yes"))
    table(Affairs$ynaffair)
    
    # fit full model
    attach(Affairs)
    fit <- glm(ynaffairs ~ gender + age + yearsmarried + children + 
                 religiousness + education + occupation + rating, 
               data = Affairs, family = binomial())
    summary(fit)
    
    # fit reduced model
    fit2 <- glm(ynaffairs ~ age + yearsmarried + religiousness + rating, 
               data = Affairs, family = binomial())
    summary(fit2)
    
    # compare models
    anova(fit, fit2, test = "Chisq")
    coef(fit2)
    exp(coef(fit2))
    
    # calculate probability of extramarital affair by marital ratings
    testdata <- data.frame(rating = c(1,2,3,4,5), 
                           age = mean(Affair$age), 
                           yearsmarried = mean(Affair$yearsmarried), 
                           religiousness = mean(Affair$religiousness))
    testdata$prob <- predict(fit2, newdata = testdata, type = "response")
    testdata
    
    # calculate probability of extramarital affair by age
    testdata <- data.frame(rating = mean(Affairs$rating), 
                           age = seq(17, 57, 10), 
                           yearsmarried = mean(Affair$yearsmarried), 
                           religiousness = mean(Affair$religiousness))
    testdata$prob <- predict(fit2, newdata = testdata, type = "response")
    testdata
    
    
    
# P61     ä¸»æˆåˆ†åˆ†æ------------------------------------------------------------
    
    # ä¸»æˆåˆ†åˆ†æï¼ˆPrincipal Component Analysis / PCAï¼‰
    # ä¸€ç§æ•°æ®é™ç»´æŠ€å·§ã€‚
    # å®ƒèƒ½å°†å¤§é‡ç›¸å…³å˜é‡è½¬åŒ–ä¸ºä¸€ç»„å¾ˆå°‘çš„ä¸ç›¸å…³å˜é‡ï¼Œè¿™äº›æ— å…³çš„å˜é‡ç§°ä¸ºä¸»æˆåˆ†ã€‚
    # ä¸»æˆåˆ†å…¶å®æ˜¯å¯¹åŸå§‹å˜é‡é‡æ–°è¿›è¡Œçº¿æ€§ç»„åˆï¼Œå°†åŸæ¥ä¼—å¤šå…·æœ‰ä¸€å®šç›¸å…³æ€§çš„æŒ‡æ ‡ï¼Œé‡æ–°ç»„åˆä¸ºä¸€ç»„çš„æ–°çš„ç›¸äº’ç‹¬ç«‹çš„ç»¼åˆæŒ‡æ ‡ã€‚
    
    # ä¸»æˆåˆ†åˆ†æå…¬å¼
    # PC1 = A1X1 + A2X2 + ... + AkXk
    
    # ä¸»æˆåˆ†åˆ†æä¸å› å­åˆ†ææ­¥éª¤
    # 1. æ•°æ®é¢„å¤„ç†
    # 2. é€‰æ‹©åˆ†ææ¨¡å‹
    # 3. åˆ¤æ–­è¦é€‰æ‹©çš„ä¸»æˆåˆ†/å› å­æ•°ç›®ï¼ˆå¯é€šè¿‡ç¢çŸ³å›¾ï¼‰
    # 4. é€‰æ‹©ä¸»æˆåˆ†/å› å­
    # 5. æ—‹è½¬ä¸»æˆåˆ†/å› å­
    # 6. è§£é‡Šç»“æœï¼ˆOptionalï¼‰
    # 7. è®¡ç®—ä¸»æˆåˆ†/å› å­å¾—åˆ†ï¼ˆOptionalï¼‰
    
    # Principal components analysis of the Judge Ratings
    library(psych)
    USJudgeRatings
    fa.parallel(USJudgeRatings, fa="pc", n.iter=100) # ç¢çŸ³å›¾ï¼ˆæ‰¾å‡ºn.factorsï¼‰
    pc <- principal(USJudgeRatings, nfactors=1)
    pc
    
    # PCA Score
    pc <- principal(USJudgeRatings, nfactors=1, scores=T) # scoreä¸ºæ˜¯å¦éœ€è¦è®¡ç®—ä¸»æˆåˆ†å¾—åˆ†ï¼Œé»˜è®¤F
    pc$scores
    
    # PCA Harman23.cor data
    fa.parallel(Harman23.cor$cov, n.obs=302, fa="pc", n.iter=100, show.legend=F, main="Scree plot with parallel analysis")
    
    # PCA of body measurement
    pc <- principal(Harman23.cor$cov, nfactors=2, rotate="none")
    pc
    
    # ä½¿æˆåˆ†ä¸ç›¸å…³ï¼šæ­£äº¤æ—‹è½¬ï¼ˆå»å™ªï¼‰
    # ä½¿æˆåˆ†ç›¸å…³ï¼šæ—‹äº¤æ—‹è½¬
    
    
    
# P62     å› å­åˆ†æ--------------------------------------------------------------
    
    # æ¢ç´¢æ€§å› å­åˆ†ææ³•ï¼ˆExploratory Factor Analysis / EFAï¼‰
    # ä¸€ç³»åˆ—ç”¨æ¥å‘ç°ä¸€ç»„å˜é‡çš„æ½œåœ¨ç»“æ„çš„æ–¹æ³•ã€‚
    # å®ƒé€šè¿‡å¯»æ‰¾ä¸€ç»„æ›´å°çš„ã€æ½œåœ¨çš„æˆ–éšè—çš„ç»“æ„æ¥è§£é‡Šå·²è§‚æµ‹åˆ°çš„ã€æ˜¾å¼çš„å˜é‡é—´çš„å…³ç³»ã€‚
    
    # å› å­åˆ†æå…¬å¼
    # Xi = A1F1 + A2F2 + ... + AkFk + Ui
    # Xiï¼šç¬¬iä¸ªå¯è§‚æµ‹çš„å˜é‡
    # Fï¼šå…¬å…±å› å­
    # Uiï¼šXiå˜é‡æ— æ³•è¢«å…¬å…±å› å­è§£é‡Šçš„éƒ¨åˆ†ï¼ˆè¯¯å·®ï¼‰
    
    # ä¸»æˆåˆ†ä¸å› å­åˆ†ææ¯”è¾ƒ
    
    # ç›¸åŒç‚¹
    # 1. éƒ½å¯¹åŸå§‹æ•°æ®è¿›è¡Œé™ç»´å¤„ç†
    # 2. éƒ½æ¶ˆé™¤äº†åŸå§‹æŒ‡æ ‡çš„ç›¸å…³æ€§å¯¹ç»¼åˆè¯„ä»·æ‰€é€ æˆçš„ä¿¡æ¯é‡å¤çš„å½±å“
    # 3. æ„é€ ç»¼åˆè¯„ä»·æ—¶æ‰€æ¶‰åŠçš„æƒæ•°å…·æœ‰å®¢è§‚æ€§
    # 4. åœ¨ä¿¡æ¯æŸå¤±ä¸å¤§çš„å‰æä¸‹ï¼Œå‡å°‘äº†è¯„ä»·å·¥ä½œé‡
    # 5. ç”¨ç¢çŸ³å›¾æ¥åˆ¤æ–­ä¸»æˆåˆ†/å› å­æ•°é‡
    
    # ä¸åŒç‚¹
    
    # ä¸»æˆåˆ†åˆ†æï¼š
    # 1. ç”¨è¾ƒå°‘çš„å˜é‡è¡¨ç¤ºåŸæ¥çš„æ ·æœ¬
    # 2. ç›®çš„æ˜¯æ ·æœ¬æ•°æ®ä¿¡æ¯æŸå¤±æœ€å°çš„åŸåˆ™ä¸‹ï¼Œå¯¹é«˜ç»´å˜é‡è¿›è¡Œé™ç»´
    # 3. å‚æ•°ä¼°è®¡ï¼Œä¸€èˆ¬æ˜¯æ±‚ç›¸å…³çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç›¸åº”çš„ç‰¹å¾å‘é‡ï¼Œå–å‰å‡ ä¸ªè®¡ç®—ä¸»æˆåˆ†
    # 4. åº”ç”¨ï¼šåº”ç”¨è¾ƒå°‘å˜é‡æ¥è§£é‡Šå„ä¸ªæ ·æœ¬çš„ç‰¹å¾
    
    # å› å­åˆ†æï¼š
    # 1. ç”¨è¾ƒå°‘çš„å› å­è¡¨ç¤ºåŸæ¥çš„å˜é‡
    # 2. ç›®çš„æ˜¯å°½å¯èƒ½ä¿å­˜åŸå˜é‡çš„ç›¸äº’å…³ç³»ï¼Œå¯»æ‰¾å˜é‡çš„å…¬å…±å› å­
    # 3. å‚æ•°ä¼°è®¡ï¼ŒæŒ‡å®šå‡ ä¸ªå› å­ï¼Œå°†å…¶è¿˜åŸæˆç›¸å…³ç³»æ•°çŸ©é˜µï¼Œåœ¨å’ŒåŸæ ·æœ¬ç›¸å…³çŸ©é˜µæœ€ç›¸ä¼¼åŸåˆ™ä¸‹ï¼Œä¼°è®¡å„ä¸ªå…¬å› å­çš„ä¼°è®¡å€¼
    # 4. åº”ç”¨ï¼šæ‰¾åˆ°å…·æœ‰æœ¬è´¨æ„ä¹‰çš„å°‘é‡å› å­æ¥å½’çº³åŸæ¥å˜é‡çš„ç‰¹å¾
    
    factanal()
    options(digits = 2)
    covariances <- ability.cov$cov
    correlations <- cov2cor(covariances) # è½¬æ¢æˆç³»æ•°çŸ©é˜µ
    fa.parallel(correlations, fa="both", n.obs=112, n.iter=100)
    fa <- fa(correlations, nfactors=2, rotate="none", fm="pa")
    # æ­£äº¤æ—‹è½¬ï¼ˆPC1å’ŒPC2æ²¡æœ‰å…³ç³»ï¼‰
    fa.varimax <- fa(correlations, nfactors=2, rotate="varimax", fm="pa")
    # æ—‹äº¤æ—‹è½¬ï¼ˆPC1å’ŒPC2æœ‰å…³ç³»ï¼‰
    fa.promax <- fa(correlations, nfactors=2, rotate="promax", fm="pa")
    
    factor.plot(fa.promax, labels = rownames(fa.promax$loadings))
    fa.diagrams(fa.varimax, simple = F)
    fa(correlations, nfactors=2, rotate="none", fm="pa", score = T)
    fa$weights # å¾—åˆ†æƒé‡
    
    
    
# P63     è´­ç‰©ç¯®åˆ†æ------------------------------------------------------------
    
    # æ•°æ®åŠ è½½
    install.packages("arules")
    data(Groceries)
    inspect(Groceries)
    
    fit <- apriori(Groceries, parameter = list(support=0.01, confidence=0.5))
    summary(fit)
    inspect(fit)
    # liftæŒ‡æ•°è¶Šå¤§ï¼Œé€»è¾‘å¯èƒ½æ€§è¶Šå¤§
    
    
    
# P64-65  åè®°------------------------------------------------------------------
    
    # ç™½å«–ä¸æ˜“ï¼Œå„è‡ªçæƒœã€‚
    
    # å¸Œæœ›ä¸–ç•Œå’Œå¹³ã€‚
    
    
    